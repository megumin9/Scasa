<!doctype html>
<html>
<head>
<title>bitcoin-cli.cpp</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { position:relative }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.msg.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Wrong iterator dereferenced -->

<!-- BUGTYPE Iterator out of range -->

<!-- BUGCATEGORY Misuse of STL APIs -->

<!-- BUGFILE /usr/STLcheck/sekitest/bitcoin/src/bitcoin-cli.cpp -->

<!-- FILENAME bitcoin-cli.cpp -->

<!-- FUNCTIONNAME ProcessReply -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 721042204bfe6b7c39b99d7049ae6da5 -->

<!-- BUGLINE 300 -->

<!-- BUGCOLUMN 30 -->

<!-- BUGPATHLENGTH 7 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>STLcheck/sekitest/bitcoin/src/bitcoin-cli.cpp</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 300, column 30</a><br />Wrong iterator dereferenced</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -analyzer-opt-analyze-nested-blocks -analyzer-config-compatibility-mode true -analyzer-purge none -analyzer-checker core -analyzer-checker apiModeling -analyzer-checker unix -analyzer-checker deadcode -analyzer-checker cplusplus -analyzer-checker security.insecureAPI.UncheckedReturn -analyzer-checker security.insecureAPI.getpw -analyzer-checker security.insecureAPI.gets -analyzer-checker security.insecureAPI.mktemp -analyzer-checker security.insecureAPI.mkstemp -analyzer-checker security.insecureAPI.vfork -analyzer-checker nullability.NullPassedToNonnull -analyzer-checker nullability.NullReturnedFromNonnull -analyzer-checker STL_seki -analyzer-disable-checker deadcode -analyzer-config experimental-enable-naive-ctu-analysis=true -analyzer-config ctu-invocation-list=/usr/STLcheck/sekitest/bitcoin/csa-scan/invocations.yaml -analyzer-config suppress-null-return-paths=false -analyzer-config ctu-index-name=/usr/STLcheck/sekitest/bitcoin/csa-scan/externalDefMap.txt -analyzer-config aggressive-binary-operation-simplification=true -analyzer-config crosscheck-with-z3=true -analyzer-config ctu-dir=/usr/STLcheck/sekitest/bitcoin/csa-scan -w -ferror-limit 19 -Wstack-protector -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wimplicit-fallthrough -Wunreachable-code -Wdocumentation -Wno-unused-parameter -Wno-self-assign -o /usr/STLcheck/sekitest/bitcoin/csa-scan/reports -disable-free -analyze -x c++ bitcoin-cli.cpp -target-cpu x86-64 -tune-cpu generic -triple x86_64-unknown-linux-gnu -resource-dir /usr/STLcheck/seki/build-release/lib/clang/15.0.0 -I . -I ../src/config -I . -I ./minisketch/include -I ./secp256k1/include -I ./univalue/include -isystem /usr/STLcheck/clang/include/clang/v1 -isystem /usr/STLcheck/seki/build-release/lib/clang/15.0.0/include -isystem /usr/local/include -isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../x86_64-linux-gnu/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -std=c++20 -fcxx-exceptions -fexceptions -fmath-errno -fno-implicit-modules -pic-level 2 -pic-is-pie -stack-protector 3 -fvisibility default -fdeprecated-macro -fgnuc-version=4.2.1 -ffp-contract=on -fno-experimental-relative-c++-abi-vtables -O2 -fdebug-compilation-dir=/usr/STLcheck/sekitest/bitcoin/src -fcoverage-compilation-dir=/usr/STLcheck/sekitest/bitcoin/src -faddrsig -fstack-clash-protection -dwarf-version=5 -debugger-tuning=gdb -funwind-tables=2 -mconstructor-aliases -vectorize-loops -vectorize-slp -clear-ast-before-backend -main-file-name bitcoin-cli.cpp -finline-functions -debug-info-kind=constructor -fcf-protection=full -fdiagnostics-hotness-threshold=0 -fdiagnostics-misexpect-tolerance=0 -setup-static-analyzer -D HAVE_CONFIG_H -U _FORTIFY_SOURCE -D _FORTIFY_SOURCE=3 -D HAVE_BUILD_INFO -D PROVIDE_FUZZ_MAIN_FUNCTION -D __GCC_HAVE_DWARF2_CFI_ASM=1
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"263": 1, "264": 1, "265": 1, "268": 1, "281": 1, "282": 1, "283": 1, "284": 1, "285": 1, "289": 1, "290": 1, "291": 1, "292": 1, "293": 1, "295": 1, "297": 1, "298": 1, "299": 1, "300": 1}, "2418": {"23": 1, "24": 1, "25": 1, "26": 1, "27": 1}, "89086": {"155": 1, "156": 1, "157": 1, "158": 1, "187": 1, "188": 1, "189": 1, "190": 1}, "180655": {"31": 1, "78": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  // SHIFT + S
  if (event.shiftKey && event.keyCode == 83) {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].click();
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
    <input type="checkbox" name="showArrows"
           id="showArrows" style="margin-left: 10px" />
    <label for="showArrows">
       Show control flow arrows
    </label>
</form>

<script type='text/javascript'>
// Return range of numbers from a range [lower, upper).
function range(lower, upper) {
  var array = [];
  for (var i = lower; i <= upper; ++i) {
      array.push(i);
  }
  return array;
}

var getRelatedArrowIndices = function(pathId) {
  // HTML numeration of events is a bit different than it is in the path.
  // Everything is rotated one step to the right, so the last element
  // (error diagnostic) has index 0.
  if (pathId == 0) {
    // arrowIndices has at least 2 elements
    pathId = arrowIndices.length - 1;
  }

  return range(arrowIndices[pathId], arrowIndices[pathId - 1]);
}

var highlightArrowsForSelectedEvent = function() {
  const selectedNum = findNum();
  const arrowIndicesToHighlight = getRelatedArrowIndices(selectedNum);
  arrowIndicesToHighlight.forEach((index) => {
    var arrow = document.querySelector("#arrow" + index);
    if(arrow) {
      classListAdd(arrow, "selected")
    }
  });
}

var getAbsoluteBoundingRect = function(element) {
  const relative = element.getBoundingClientRect();
  return {
    left: relative.left + window.pageXOffset,
    right: relative.right + window.pageXOffset,
    top: relative.top + window.pageYOffset,
    bottom: relative.bottom + window.pageYOffset,
    height: relative.height,
    width: relative.width
  };
}

var drawArrow = function(index) {
  // This function is based on the great answer from SO:
  //   https://stackoverflow.com/a/39575674/11582326
  var start = document.querySelector("#start" + index);
  var end   = document.querySelector("#end" + index);
  var arrow = document.querySelector("#arrow" + index);

  var startRect = getAbsoluteBoundingRect(start);
  var endRect   = getAbsoluteBoundingRect(end);

  // It is an arrow from a token to itself, no need to visualize it.
  if (startRect.top == endRect.top &&
      startRect.left == endRect.left)
    return;

  // Each arrow is a very simple BÃ©zier curve, with two nodes and
  // two handles.  So, we need to calculate four points in the window:
  //   * start node
  var posStart    = { x: 0, y: 0 };
  //   * end node
  var posEnd      = { x: 0, y: 0 };
  //   * handle for the start node
  var startHandle = { x: 0, y: 0 };
  //   * handle for the end node
  var endHandle   = { x: 0, y: 0 };
  // One can visualize it as follows:
  //
  //         start handle
  //        /
  //       X"""_.-""""X
  //         .'        \
  //        /           start node
  //       |
  //       |
  //       |      end node
  //        \    /
  //         `->X
  //        X-'
  //         \
  //          end handle
  //
  // NOTE: (0, 0) is the top left corner of the window.

  // We have 3 similar, but still different scenarios to cover:
  //
  //   1. Two tokens on different lines.
  //             -xxx
  //           /
  //           \
  //             -> xxx
  //      In this situation, we draw arrow on the left curving to the left.
  //   2. Two tokens on the same line, and the destination is on the right.
  //             ____
  //            /    \
  //           /      V
  //        xxx        xxx
  //      In this situation, we draw arrow above curving upwards.
  //   3. Two tokens on the same line, and the destination is on the left.
  //        xxx        xxx
  //           ^      /
  //            \____/
  //      In this situation, we draw arrow below curving downwards.
  const onDifferentLines = startRect.top <= endRect.top - 5 ||
    startRect.top >= endRect.top + 5;
  const leftToRight = startRect.left < endRect.left;

  // NOTE: various magic constants are chosen empirically for
  //       better positioning and look
  if (onDifferentLines) {
    // Case #1
    const topToBottom = startRect.top < endRect.top;
    posStart.x = startRect.left - 1;
    // We don't want to start it at the top left corner of the token,
    // it doesn't feel like this is where the arrow comes from.
    // For this reason, we start it in the middle of the left side
    // of the token.
    posStart.y = startRect.top + startRect.height / 2;

    // End node has arrow head and we give it a bit more space.
    posEnd.x = endRect.left - 4;
    posEnd.y = endRect.top;

    // Utility object with x and y offsets for handles.
    var curvature = {
      // We want bottom-to-top arrow to curve a bit more, so it doesn't
      // overlap much with top-to-bottom curves (much more frequent).
      x: topToBottom ? 15 : 25,
      y: Math.min((posEnd.y - posStart.y) / 3, 10)
    }

    // When destination is on the different line, we can make a
    // curvier arrow because we have space for it.
    // So, instead of using
    //
    //   startHandle.x = posStart.x - curvature.x
    //   endHandle.x   = posEnd.x - curvature.x
    //
    // We use the leftmost of these two values for both handles.
    startHandle.x = Math.min(posStart.x, posEnd.x) - curvature.x;
    endHandle.x = startHandle.x;

    // Curving downwards from the start node...
    startHandle.y = posStart.y + curvature.y;
    // ... and upwards from the end node.
    endHandle.y = posEnd.y - curvature.y;

  } else if (leftToRight) {
    // Case #2
    // Starting from the top right corner...
    posStart.x = startRect.right - 1;
    posStart.y = startRect.top;

    // ...and ending at the top left corner of the end token.
    posEnd.x = endRect.left + 1;
    posEnd.y = endRect.top - 1;

    // Utility object with x and y offsets for handles.
    var curvature = {
      x: Math.min((posEnd.x - posStart.x) / 3, 15),
      y: 5
    }

    // Curving to the right...
    startHandle.x = posStart.x + curvature.x;
    // ... and upwards from the start node.
    startHandle.y = posStart.y - curvature.y;

    // And to the left...
    endHandle.x = posEnd.x - curvature.x;
    // ... and upwards from the end node.
    endHandle.y = posEnd.y - curvature.y;

  } else {
    // Case #3
    // Starting from the bottom right corner...
    posStart.x = startRect.right;
    posStart.y = startRect.bottom;

    // ...and ending also at the bottom right corner, but of the end token.
    posEnd.x = endRect.right - 1;
    posEnd.y = endRect.bottom + 1;

    // Utility object with x and y offsets for handles.
    var curvature = {
      x: Math.min((posStart.x - posEnd.x) / 3, 15),
      y: 5
    }

    // Curving to the left...
    startHandle.x = posStart.x - curvature.x;
    // ... and downwards from the start node.
    startHandle.y = posStart.y + curvature.y;

    // And to the right...
    endHandle.x = posEnd.x + curvature.x;
    // ... and downwards from the end node.
    endHandle.y = posEnd.y + curvature.y;
  }

  // Put it all together into a path.
  // More information on the format:
  //   https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths
  var pathStr = "M" + posStart.x + "," + posStart.y + " " +
    "C" + startHandle.x + "," + startHandle.y + " " +
    endHandle.x + "," + endHandle.y + " " +
    posEnd.x + "," + posEnd.y;

  arrow.setAttribute("d", pathStr);
};

var drawArrows = function() {
  const numOfArrows = document.querySelectorAll("path[id^=arrow]").length;
  for (var i = 0; i < numOfArrows; ++i) {
    drawArrow(i);
  }
}

var toggleArrows = function(event) {
  const arrows = document.querySelector("#arrows");
  if (event.target.checked) {
    arrows.setAttribute("visibility", "visible");
  } else {
    arrows.setAttribute("visibility", "hidden");
  }
}

window.addEventListener("resize", drawArrows);
document.addEventListener("DOMContentLoaded", function() {
  // Whenever we show invocation, locations change, i.e. we
  // need to redraw arrows.
  document
    .querySelector('input[id="showinvocation"]')
    .addEventListener("click", drawArrows);
  // Hiding irrelevant lines also should cause arrow rerender.
  document
    .querySelector('input[name="showCounterexample"]')
    .addEventListener("change", drawArrows);
  document
    .querySelector('input[name="showArrows"]')
    .addEventListener("change", toggleArrows);
  drawArrows();
  // Default highlighting for the last event.
  highlightArrowsForSelectedEvent();
});
</script>
  
<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".msg.selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var classListAdd = function(el, theClass) {
  if(!el.className.baseVal)
    el.className += " " + theClass;
  else
    el.className.baseVal += " " + theClass;
};

var classListRemove = function(el, theClass) {
  var className = (!el.className.baseVal) ?
      el.className : el.className.baseVal;
    className = className.replace(" " + theClass, "");
  if(!el.className.baseVal)
    el.className = className;
  else
    el.className.baseVal = className;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
      classListRemove(s, "selected");
    });
    classListAdd(el, "selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
    highlightArrowsForSelectedEvent();
};

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  // key 'j'
  if (event.keyCode == 74) {
    navigateTo(/*up=*/false);
  // key 'k'
  } else if (event.keyCode == 75) {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>
<div id=File1>
<h4 class=FileName>bitcoin-cli.cpp</h4>
<div class=FileNav><a href="#File180655">&#x2192;</a></div></div>

<style type="text/css">
  svg {
      position:absolute;
      top:0;
      left:0;
      height:100%;
      width:100%;
      pointer-events: none;
      overflow: visible
  }
  .arrow {
      stroke-opacity: 0.2;
      stroke-width: 1;
      marker-end: url(#arrowhead);
  }

  .arrow.selected {
      stroke-opacity: 0.6;
      stroke-width: 2;
      marker-end: url(#arrowheadSelected);
  }

  .arrowhead {
      orient: auto;
      stroke: none;
      opacity: 0.6;
      fill: blue;
  }
</style>
<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowheadSelected" class="arrowhead" opacity="0.6"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowhead" class="arrowhead" opacity="0.2"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  <g id="arrows" fill="none" stroke="blue" visibility="hidden">
    <path class="arrow" id="arrow0"/>
    <path class="arrow" id="arrow1"/>
    <path class="arrow" id="arrow2"/>
    <path class="arrow" id="arrow3"/>
    <path class="arrow" id="arrow4"/>
    <path class="arrow" id="arrow5"/>
    <path class="arrow" id="arrow6"/>
    <path class="arrow" id="arrow7"/>
    <path class="arrow" id="arrow8"/>
    <path class="arrow" id="arrow9"/>
    <path class="arrow" id="arrow10"/>
    <path class="arrow" id="arrow11"/>
    <path class="arrow" id="arrow12"/>
    <path class="arrow" id="arrow13"/>
    <path class="arrow" id="arrow14"/>
    <path class="arrow" id="arrow15"/>
    <path class="arrow" id="arrow16"/>
    <path class="arrow" id="arrow17"/>
    <path class="arrow" id="arrow18"/>

  </g>
</svg>
<script type='text/javascript'>
const arrowIndices = [ 19,18,13,9,7,1,0 ]
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>// Copyright (c) 2009-2010 Satoshi Nakamoto</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>// Copyright (c) 2009-2022 The Bitcoin Core developers</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the MIT software license, see the accompanying</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#if defined(<span class='macro'>HAVE_CONFIG_H<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#include &lt;config/bitcoin-config.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;chainparamsbase.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;clientversion.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;common/args.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;common/system.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;common/url.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;compat/compat.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;compat/<span class='macro'>stdin<span class='macro_popup'>stdin</span></span>.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;policy/feerate.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include &lt;rpc/client.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include &lt;rpc/mining.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include &lt;rpc/protocol.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include &lt;rpc/request.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include &lt;tinyformat.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include &lt;univalue.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include &lt;util/chaintype.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include &lt;util/exception.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include &lt;util/strencodings.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#include &lt;util/time.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line"><span class='directive'>#include &lt;util/translation.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line"><span class='directive'>#include &lt;algorithm&gt;</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#include &lt;chrono&gt;</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line"><span class='directive'>#include &lt;cmath&gt;</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line"><span class='directive'>#include &lt;cstdio&gt;</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line"><span class='directive'>#include &lt;functional&gt;</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line"><span class='directive'>#include &lt;memory&gt;</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line"><span class='directive'>#include &lt;optional&gt;</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line"><span class='directive'>#include &lt;string&gt;</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line"><span class='directive'>#include &lt;tuple&gt;</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line"><span class='directive'>#include &lt;unistd.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line"><span class='directive'>#include &lt;event2/buffer.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line"><span class='directive'>#include &lt;event2/keyvalq_struct.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line"><span class='directive'>#include &lt;support/events.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line"><span class='comment'>// The server returns time values from a mockable system clock, but it is not</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line"><span class='comment'>// trivial to get the mocked time from the server, nor is it needed for now, so</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line"><span class='comment'>// just use a plain system_clock.</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line"><span class='keyword'>using</span> CliClock = std::chrono::system_clock;</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"><span class='keyword'>const</span> std::function&lt;std::string(<span class='keyword'>const</span> <span class='keyword'>char</span>*)&gt; G_TRANSLATION_FUN = <span class='keyword'>nullptr</span>;</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">UrlDecodeFn* <span class='keyword'>const</span> URL_DECODE = urlDecode;</td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> DEFAULT_RPCCONNECT[] = <span class='string_literal'>"127.0.0.1"</span>;</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> DEFAULT_HTTP_CLIENT_TIMEOUT=900;</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>int</span> DEFAULT_WAIT_CLIENT_TIMEOUT = 0;</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>bool</span> DEFAULT_NAMED=<span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> CONTINUE_EXECUTION=-1;</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>constexpr</span> int8_t UNKNOWN_NETWORK{-1};</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line"><span class='comment'>// See GetNetworkName() in netbase.cpp</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>constexpr</span> std::array NETWORKS{<span class='string_literal'>"not_publicly_routable"</span>, <span class='string_literal'>"ipv4"</span>, <span class='string_literal'>"ipv6"</span>, <span class='string_literal'>"onion"</span>, <span class='string_literal'>"i2p"</span>, <span class='string_literal'>"cjdns"</span>, <span class='string_literal'>"internal"</span>};</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>constexpr</span> std::array NETWORK_SHORT_NAMES{<span class='string_literal'>"npr"</span>, <span class='string_literal'>"ipv4"</span>, <span class='string_literal'>"ipv6"</span>, <span class='string_literal'>"onion"</span>, <span class='string_literal'>"i2p"</span>, <span class='string_literal'>"cjdns"</span>, <span class='string_literal'>"int"</span>};</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>constexpr</span> std::array UNREACHABLE_NETWORK_IDS{<span class='comment'>/*not_publicly_routable*/</span>0, <span class='comment'>/*internal*/</span>6};</td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"><span class='comment'>/** Default number of blocks to generate for RPC generatetoaddress. */</span></td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> std::string DEFAULT_NBLOCKS = <span class='string_literal'>"1"</span>;</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line"><span class='comment'>/** Default -color setting. */</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> std::string DEFAULT_COLOR_SETTING{<span class='string_literal'>"auto"</span>};</td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> SetupCliArgs(ArgsManager&amp; argsman)</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    SetupHelpOptions(argsman);</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> defaultBaseParams = CreateBaseChainParams(ChainType::MAIN);</td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> testnetBaseParams = CreateBaseChainParams(ChainType::TESTNET);</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> signetBaseParams = CreateBaseChainParams(ChainType::SIGNET);</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> regtestBaseParams = CreateBaseChainParams(ChainType::REGTEST);</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-version"</span>, <span class='string_literal'>"Print version and exit"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-conf=&lt;file&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Specify configuration file. Relative paths will be prefixed by datadir location. (default: %s)"</span>, BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-datadir=&lt;dir&gt;"</span>, <span class='string_literal'>"Specify data directory"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-generate"</span>,</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line">                   <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Generate blocks, equivalent to RPC getnewaddress followed by RPC generatetoaddress. Optional positional integer "</span></td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">                             <span class='string_literal'>"arguments are number of blocks to generate (default: %s) and maximum iterations to try (default: %s), equivalent to "</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">                             <span class='string_literal'>"RPC generatetoaddress nblocks and maxtries arguments. Example: bitcoin-cli -generate 4 1000"</span>,</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">                             DEFAULT_NBLOCKS, DEFAULT_MAX_TRIES),</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">                   ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-addrinfo"</span>, <span class='string_literal'>"Get the number of addresses known to the node, per network and total, after filtering for quality and recency. The total number of addresses known to the node may be higher."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-getinfo"</span>, <span class='string_literal'>"Get general information from the remote server. Note that unlike server-side RPC calls, the output of -getinfo is the result of multiple non-atomic requests. Some entries in the output may represent results from different states (e.g. wallet balance may be as of a different block from the chain state reported)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-netinfo"</span>, <span class='string_literal'>"Get network peer connection information from the remote server. An optional integer argument from 0 to 4 can be passed for different peers listings (default: 0). Pass \"help\" for detailed help documentation."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">    SetupChainParamsBaseOptions(argsman);</td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-color=&lt;when&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Color setting for CLI output (default: %s). Valid values: always, auto (add color codes when standard output is connected to a terminal and OS is not WIN32), never."</span>, DEFAULT_COLOR_SETTING), ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-named"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Pass named instead of positional arguments (default: %s)"</span>, DEFAULT_NAMED), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcclienttimeout=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)"</span>, DEFAULT_HTTP_CLIENT_TIMEOUT), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcconnect=&lt;ip&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Send commands to node running on &lt;ip&gt; (default: %s)"</span>, DEFAULT_RPCCONNECT), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpccookiefile=&lt;loc&gt;"</span>, <span class='string_literal'>"Location of the auth cookie. Relative paths will be prefixed by a net-specific datadir location. (default: data dir)"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcpassword=&lt;pw&gt;"</span>, <span class='string_literal'>"Password for JSON-RPC connections"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcport=&lt;port&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Connect to JSON-RPC on &lt;port&gt; (default: %u, testnet: %u, signet: %u, regtest: %u)"</span>, defaultBaseParams-&gt;RPCPort(), testnetBaseParams-&gt;RPCPort(), signetBaseParams-&gt;RPCPort(), regtestBaseParams-&gt;RPCPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcuser=&lt;user&gt;"</span>, <span class='string_literal'>"Username for JSON-RPC connections"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcwait"</span>, <span class='string_literal'>"Wait for RPC server to start"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcwaittimeout=&lt;n&gt;"</span>, <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Timeout in seconds to wait for the RPC server to start, or 0 for no timeout. (default: %d)"</span>, DEFAULT_WAIT_CLIENT_TIMEOUT), ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-rpcwallet=&lt;walletname&gt;"</span>, <span class='string_literal'>"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind). This changes the RPC endpoint used, e.g. http://127.0.0.1:8332/wallet/&lt;walletname&gt;"</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-stdin"</span>, <span class='string_literal'>"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases). When combined with -stdinrpcpass, the first line from standard input is used for the RPC password."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-stdinrpcpass"</span>, <span class='string_literal'>"Read RPC password from standard input as a single line. When combined with -stdin, the first line from standard input is used for the RPC password. When combined with -stdinwalletpassphrase, -stdinrpcpass consumes the first line, and -stdinwalletpassphrase consumes the second."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    argsman.AddArg(<span class='string_literal'>"-stdinwalletpassphrase"</span>, <span class='string_literal'>"Read wallet passphrase from standard input as a single line. When combined with -stdin, the first line from standard input is used for the wallet passphrase."</span>, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='comment'>/** libevent event log callback */</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> libevent_log_cb(<span class='keyword'>int</span> severity, <span class='keyword'>const</span> <span class='keyword'>char</span> *msg)</td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">    <span class='comment'>// Ignore everything other than errors</span></td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">    <span class='keyword'>if</span> (severity &gt;= <span class='macro'>EVENT_LOG_ERR<span class='macro_popup'>3</span></span>) {</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"libevent error: %s"</span>, msg));</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"><span class='comment'>// Exception thrown on connection error.  This error is used to determine</span></td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line"><span class='comment'>// when to wait if -rpcwait is given.</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"><span class='keyword'>class</span> CConnectionFailed : <span class='keyword'>public</span> std::runtime_error</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">    <span class='keyword'>explicit</span> <span class='keyword'>inline</span> CConnectionFailed(<span class='keyword'>const</span> std::string&amp; msg) :</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line">        std::runtime_error(msg)</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">    {}</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='comment'>// This function returns either one of EXIT_ codes when it's expected to stop the process or</span></td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line"><span class='comment'>// CONTINUE_EXECUTION when it's expected to continue further.</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line"><span class='comment'>//</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> AppInitRPC(<span class='keyword'>int</span> argc, <span class='keyword'>char</span>* argv[])</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">    SetupCliArgs(gArgs);</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">    std::string error;</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">    <span class='keyword'>if</span> (!gArgs.ParseParameters(argc, argv, error)) {</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">        tfm::format(std::cerr, <span class='string_literal'>"Error parsing command line arguments: %s\n"</span>, error);</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">    <span class='keyword'>if</span> (argc &lt; 2 || HelpRequested(gArgs) || gArgs.IsArgSet(<span class='string_literal'>"-version"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line">        std::string strUsage = <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span> <span class='string_literal'>" RPC client version "</span> + FormatFullVersion() + <span class='string_literal'>"\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">        <span class='keyword'>if</span> (gArgs.IsArgSet(<span class='string_literal'>"-version"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">            strUsage += FormatParagraph(LicenseInfo());</td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">            strUsage += <span class='string_literal'>"\n"</span></td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">                <span class='string_literal'>"Usage:  bitcoin-cli [options] &lt;command&gt; [params]  Send command to "</span> <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span> <span class='string_literal'>"\n"</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">                <span class='string_literal'>"or:     bitcoin-cli [options] -named &lt;command&gt; [name=value]...  Send command to "</span> <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span> <span class='string_literal'>" (with named arguments)\n"</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">                <span class='string_literal'>"or:     bitcoin-cli [options] help                List commands\n"</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">                <span class='string_literal'>"or:     bitcoin-cli [options] help &lt;command&gt;      Get help for a command\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">            strUsage += <span class='string_literal'>"\n"</span> + gArgs.GetHelpMessage();</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">        tfm::format(std::cout, <span class='string_literal'>"%s"</span>, strUsage);</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">        <span class='keyword'>if</span> (argc &lt; 2) {</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">            tfm::format(std::cerr, <span class='string_literal'>"Error: too few parameters\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line">            <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_SUCCESS<span class='macro_popup'>0</span></span>;</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line">    <span class='keyword'>if</span> (!CheckDataDirOption(gArgs)) {</td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line">        tfm::format(std::cerr, <span class='string_literal'>"Error: Specified data directory \"%s\" does not exist.\n"</span>, gArgs.GetArg(<span class='string_literal'>"-datadir"</span>, <span class='string_literal'>""</span>));</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    <span class='keyword'>if</span> (!gArgs.ReadConfigFiles(error, <span class='keyword'>true</span>)) {</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">        tfm::format(std::cerr, <span class='string_literal'>"Error reading configuration file: %s\n"</span>, error);</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    <span class='comment'>// Check for chain settings (BaseParams() calls are only valid after this clause)</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">    <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line">        SelectBaseParams(gArgs.GetChainType());</td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">    } <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">        tfm::format(std::cerr, <span class='string_literal'>"Error: %s\n"</span>, e.what());</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">    <span class='keyword'>return</span> CONTINUE_EXECUTION;</td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='comment'>/** Reply structure for request_done to fill in */</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"><span class='keyword'>struct</span> HTTPReply</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">    HTTPReply() = <span class='keyword'>default</span>;</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">    <span class='keyword'>int</span> status{0};</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">    <span class='keyword'>int</span> error{-1};</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">    std::string body;</td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"><span class='keyword'>static</span> std::string http_errorstring(<span class='keyword'>int</span> code)</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">    <span class='keyword'>switch</span>(code) {</td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_TIMEOUT:</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"timeout reached"</span>;</td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_EOF:</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"EOF reached"</span>;</td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_INVALID_HEADER:</td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"error while reading header, or invalid header"</span>;</td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_BUFFER_ERROR:</td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"error encountered while reading or writing"</span>;</td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_REQUEST_CANCEL:</td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"request was canceled"</span>;</td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line">    <span class='keyword'>case</span> EVREQ_HTTP_DATA_TOO_LONG:</td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"response body is larger than allowed"</span>;</td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>"unknown"</span>;</td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> http_request_done(<span class='keyword'>struct</span> evhttp_request *req, <span class='keyword'>void</span> *ctx)</td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line">    HTTPReply *reply = <span class='keyword'>static_cast</span>&lt;HTTPReply*&gt;(ctx);</td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line">    <span class='keyword'>if</span> (req == <span class='keyword'>nullptr</span>) {</td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line">        <span class='comment'>/* If req is nullptr, it means an error occurred while connecting: the</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line">         <span class='comment'>* error code will have been passed to http_error_cb.</span></td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line">         <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line">        reply-&gt;status = 0;</td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line">        <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line">    reply-&gt;status = evhttp_request_get_response_code(req);</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line">    <span class='keyword'>struct</span> evbuffer *buf = evhttp_request_get_input_buffer(req);</td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>if</span> (buf)</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line">        size_t size = evbuffer_get_length(buf);</td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>char</span> *data = (<span class='keyword'>const</span> <span class='keyword'>char</span>*)evbuffer_pullup(buf, size);</td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">        <span class='keyword'>if</span> (data)</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line">            reply-&gt;body = std::string(data, size);</td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line">        evbuffer_drain(buf, size);</td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> http_error_cb(<span class='keyword'>enum</span> evhttp_request_error err, <span class='keyword'>void</span> *ctx)</td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line">    HTTPReply *reply = <span class='keyword'>static_cast</span>&lt;HTTPReply*&gt;(ctx);</td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line">    reply-&gt;error = err;</td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"><span class='comment'>/** Class that handles the conversion from a command-line to a JSON-RPC request,</span></td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line"> <span class='comment'>* as well as converting back to a JSON object that can be shown as result.</span></td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line"><span class='keyword'>class</span> BaseRequestHandler</td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line">    <span class='keyword'>virtual</span> ~BaseRequestHandler() = <span class='keyword'>default</span>;</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line">    <span class='keyword'>virtual</span> UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) = 0;</td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line">    <span class='keyword'>virtual</span> UniValue ProcessReply(<span class='keyword'>const</span> UniValue &amp;batch_in) = 0;</td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"><span class='comment'>/** Process addrinfo requests */</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"><span class='keyword'>class</span> AddrinfoRequestHandler : <span class='keyword'>public</span> BaseRequestHandler</td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line">    int8_t NetworkStringToId(<span class='keyword'>const</span> std::string&amp; str) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line">        <span class='keyword'>for</span> (size_t i = 0; i &lt; NETWORKS.size(); ++i) {</td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line">            <span class='keyword'>if</span> (str == NETWORKS[i]) <span class='keyword'>return</span> i;</td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line">        <span class='keyword'>return</span> UNKNOWN_NETWORK;</td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line">    UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) override</td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line">        <span class='keyword'>if</span> (!args.empty()) {</td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-addrinfo takes no arguments"</span>);</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line">        UniValue params{RPCConvertValues(<span class='string_literal'>"getnodeaddresses"</span>, std::vector&lt;std::string&gt;{{<span class='string_literal'>"0"</span>}})};</td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line">        <span class='keyword'>return</span> JSONRPCRequestObj(<span class='string_literal'>"getnodeaddresses"</span>, params, 1);</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">    UniValue ProcessReply(<span class='keyword'>const</span> UniValue&amp; reply) override</td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line">        <span class='keyword'>if</span> (!reply[<span class='string_literal'>"error"</span>].isNull()) <span class='keyword'>return</span> reply;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path1" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">1</div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path2" title="Next event (2)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">        <span id="start16"><span id="end17"><span id="start18"><span class='keyword'>const</span></span></span></span> std::vector&lt;UniValue&gt;&amp; nodes{reply<span id="start17"><span id="end18">[</span></span><span class='string_literal'>"result"</span>].getValues()};</td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">        <span id="start15"><span id="end16"><span class='keyword'>if</span></span></span> (<span id="start14"><span id="end15">!</span></span>nodes.empty() &amp;&amp; <span id="start13"><span id="end14">nodes</span></span>.at(0)[<span class='string_literal'>"network"</span>].isNull()) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path2" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">2</div></td><td><div class="PathNav"><a href="#Path1" title="Previous event (1)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path3" title="Next event (3)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-addrinfo requires bitcoind server to be running v22.0 and up"</span>);</td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">        <span class='comment'>// Count the number of peers known to our node, by network.</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">        <span id="start12"><span id="end13">std</span></span>::array&lt;uint64_t, NETWORKS.size()&gt; counts{{}};</td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line">        <span id="start5"><span id="end6"><span id="start7"><span id="end8"><span class='keyword'>for</span></span></span></span></span> (<span class='keyword'>const</span> UniValue&amp; node <span id="end7">:</span> nodes) {</td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">            <span id="start11"><span id="end12">std</span></span>::string network_name{node[<span class='string_literal'>"network"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">            <span class='keyword'>const</span> int8_t network_id{NetworkStringToId(network_name)};</td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">            <span id="start10"><span id="end11"><span class='keyword'>if</span></span></span> (<span id="start9"><span id="end10"><span class='variable'><span class='variable'>network_id<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>2.1</div></td><td>'network_id' is equal to 'UNKNOWN_NETWORK'</td></tr></tbody></table></span><table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>2.1</div></td><td>'network_id' is equal to 'UNKNOWN_NETWORK'</td></tr></tbody></table></span></span></span> == UNKNOWN_NETWORK) <span id="start8"><span id="end9"><span class='keyword'>continue</span></span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path3" class="msg msgControl" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">3</div></td><td><div class="PathNav"><a href="#Path2" title="Previous event (2)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path4" title="Next event (4)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path4" class="msg msgControl" style="margin-left:48ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">4</div></td><td><div class="PathNav"><a href="#Path3" title="Previous event (3)">&#x2190;</a></div></td><td> Execution continues on line 290</td><td><div class="PathNav"><a href="#Path5" title="Next event (5)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line">            ++counts.at(network_id);</td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">        <span id="start6">}</td></tr></span>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">        <span class='comment'>// Prepare result to return to user.</span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">        UniValue <span id="start4"><span id="end5">result</span></span>{UniValue::VOBJ}, addresses{UniValue::VOBJ};</td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">        <span id="start2"><span id="end3">uint64_t</span></span> total{0}; <span class='comment'>// Total address count</span></td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line">        <span id="start1"><span id="end2"><span class='keyword'>for</span></span></span> (size_t i = 1; i &lt; NETWORKS.size() - 1; ++i) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path5" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">5</div></td><td><div class="PathNav"><a href="#Path4" title="Previous event (4)">&#x2190;</a></div></td><td>Loop condition is true.  Entering loop body</td><td><div class="PathNav"><a href="#EndPath" title="Next event (6)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line">            <span id="start0"><span id="end1">addresses</span></span>.pushKV(<span class="mrange"><span id="end0">NETWORKS</span>[i]</span>, counts.at(i));</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:30ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">6</div></td><td><div class="PathNav"><a href="#Path5" title="Previous event (5)">&#x2190;</a></div></td><td>Wrong iterator dereferenced</td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line">            total += counts.at(i);</td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line">        addresses.pushKV(<span class='string_literal'>"total"</span>, total);</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line">        result.pushKV(<span class='string_literal'>"addresses_known"</span>, addresses);</td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line">        <span class='keyword'>return</span> JSONRPCReplyObj(result, NullUniValue, 1);</td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"><span class='comment'>/** Process getinfo requests */</span></td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"><span class='keyword'>class</span> GetinfoRequestHandler: <span class='keyword'>public</span> BaseRequestHandler</td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> ID_NETWORKINFO = 0;</td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> ID_BLOCKCHAININFO = 1;</td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> ID_WALLETINFO = 2;</td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> ID_BALANCES = 3;</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line">    <span class='comment'>/** Create a simulated `getinfo` request. */</span></td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line">    UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) override</td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line">        <span class='keyword'>if</span> (!args.empty()) {</td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-getinfo takes no arguments"</span>);</td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line">        UniValue result(UniValue::VARR);</td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getnetworkinfo"</span>, NullUniValue, ID_NETWORKINFO));</td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getblockchaininfo"</span>, NullUniValue, ID_BLOCKCHAININFO));</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getwalletinfo"</span>, NullUniValue, ID_WALLETINFO));</td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getbalances"</span>, NullUniValue, ID_BALANCES));</td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line">        <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line">    <span class='comment'>/** Collect values from the batch and form a simulated `getinfo` reply. */</span></td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line">    UniValue ProcessReply(<span class='keyword'>const</span> UniValue &amp;batch_in) override</td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line">        UniValue result(UniValue::VOBJ);</td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line">        <span class='keyword'>const</span> std::vector&lt;UniValue&gt; batch = JSONRPCProcessBatchReply(batch_in);</td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line">        <span class='comment'>// Errors in getnetworkinfo() and getblockchaininfo() are fatal, pass them on;</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line">        <span class='comment'>// getwalletinfo() and getbalances() are allowed to fail if there is no wallet.</span></td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_NETWORKINFO][<span class='string_literal'>"error"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line">            <span class='keyword'>return</span> batch[ID_NETWORKINFO];</td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_BLOCKCHAININFO][<span class='string_literal'>"error"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line">            <span class='keyword'>return</span> batch[ID_BLOCKCHAININFO];</td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line">        result.pushKV(<span class='string_literal'>"version"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"version"</span>]);</td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line">        result.pushKV(<span class='string_literal'>"blocks"</span>, batch[ID_BLOCKCHAININFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"blocks"</span>]);</td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">        result.pushKV(<span class='string_literal'>"headers"</span>, batch[ID_BLOCKCHAININFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"headers"</span>]);</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line">        result.pushKV(<span class='string_literal'>"verificationprogress"</span>, batch[ID_BLOCKCHAININFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"verificationprogress"</span>]);</td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line">        result.pushKV(<span class='string_literal'>"timeoffset"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"timeoffset"</span>]);</td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line">        UniValue connections(UniValue::VOBJ);</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line">        connections.pushKV(<span class='string_literal'>"in"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"connections_in"</span>]);</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line">        connections.pushKV(<span class='string_literal'>"out"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"connections_out"</span>]);</td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line">        connections.pushKV(<span class='string_literal'>"total"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"connections"</span>]);</td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">        result.pushKV(<span class='string_literal'>"connections"</span>, connections);</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line">        result.pushKV(<span class='string_literal'>"networks"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"networks"</span>]);</td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line">        result.pushKV(<span class='string_literal'>"difficulty"</span>, batch[ID_BLOCKCHAININFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"difficulty"</span>]);</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line">        result.pushKV(<span class='string_literal'>"chain"</span>, UniValue(batch[ID_BLOCKCHAININFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"chain"</span>]));</td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line">            result.pushKV(<span class='string_literal'>"has_wallet"</span>, <span class='keyword'>true</span>);</td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line">            result.pushKV(<span class='string_literal'>"keypoolsize"</span>, batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"keypoolsize"</span>]);</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line">            result.pushKV(<span class='string_literal'>"walletname"</span>, batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"walletname"</span>]);</td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line">            <span class='keyword'>if</span> (!batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"unlocked_until"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line">                result.pushKV(<span class='string_literal'>"unlocked_until"</span>, batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"unlocked_until"</span>]);</td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line">            result.pushKV(<span class='string_literal'>"paytxfee"</span>, batch[ID_WALLETINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"paytxfee"</span>]);</td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_BALANCES][<span class='string_literal'>"result"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line">            result.pushKV(<span class='string_literal'>"balance"</span>, batch[ID_BALANCES][<span class='string_literal'>"result"</span>][<span class='string_literal'>"mine"</span>][<span class='string_literal'>"trusted"</span>]);</td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line">        result.pushKV(<span class='string_literal'>"relayfee"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"relayfee"</span>]);</td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line">        result.pushKV(<span class='string_literal'>"warnings"</span>, batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>][<span class='string_literal'>"warnings"</span>]);</td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line">        <span class='keyword'>return</span> JSONRPCReplyObj(result, NullUniValue, 1);</td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line"><span class='comment'>/** Process netinfo requests */</span></td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"><span class='keyword'>class</span> NetinfoRequestHandler : <span class='keyword'>public</span> BaseRequestHandler</td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> uint8_t MAX_DETAIL_LEVEL{4};</td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line">    std::array&lt;std::array&lt;uint16_t, NETWORKS.size() + 1&gt;, 3&gt; m_counts{{{}}}; <span class='comment'>//!&lt; Peer counts by (in/out/total, networks/total)</span></td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line">    uint8_t m_block_relay_peers_count{0};</td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line">    uint8_t m_manual_peers_count{0};</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line">    int8_t NetworkStringToId(<span class='keyword'>const</span> std::string&amp; str) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line">        <span class='keyword'>for</span> (size_t i = 0; i &lt; NETWORKS.size(); ++i) {</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line">            <span class='keyword'>if</span> (str == NETWORKS[i]) <span class='keyword'>return</span> i;</td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line">        <span class='keyword'>return</span> UNKNOWN_NETWORK;</td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">    uint8_t m_details_level{0}; <span class='comment'>//!&lt; Optional user-supplied arg to set dashboard details level</span></td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">    <span class='keyword'>bool</span> DetailsRequested() <span class='keyword'>const</span> { <span class='keyword'>return</span> m_details_level &gt; 0 &amp;&amp; m_details_level &lt; 5; }</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">    <span class='keyword'>bool</span> IsAddressSelected() <span class='keyword'>const</span> { <span class='keyword'>return</span> m_details_level == 2 || m_details_level == 4; }</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">    <span class='keyword'>bool</span> IsVersionSelected() <span class='keyword'>const</span> { <span class='keyword'>return</span> m_details_level == 3 || m_details_level == 4; }</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">    <span class='keyword'>bool</span> m_is_asmap_on{<span class='keyword'>false</span>};</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">    size_t m_max_addr_length{0};</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">    size_t m_max_addr_processed_length{5};</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">    size_t m_max_addr_rate_limited_length{6};</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">    size_t m_max_age_length{5};</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">    size_t m_max_id_length{2};</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">    <span class='keyword'>struct</span> Peer {</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">        std::string addr;</td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">        std::string sub_version;</td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">        std::string conn_type;</td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">        std::string network;</td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">        std::string age;</td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">        std::string transport_protocol_type;</td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">        <span class='keyword'>double</span> min_ping;</td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">        <span class='keyword'>double</span> ping;</td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">        int64_t addr_processed;</td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">        int64_t addr_rate_limited;</td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">        int64_t last_blck;</td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">        int64_t last_recv;</td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">        int64_t last_send;</td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">        int64_t last_trxn;</td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">        <span class='keyword'>int</span> id;</td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">        <span class='keyword'>int</span> mapped_as;</td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">        <span class='keyword'>int</span> version;</td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">        <span class='keyword'>bool</span> is_addr_relay_enabled;</td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">        <span class='keyword'>bool</span> is_bip152_hb_from;</td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">        <span class='keyword'>bool</span> is_bip152_hb_to;</td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">        <span class='keyword'>bool</span> is_outbound;</td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">        <span class='keyword'>bool</span> is_tx_relay;</td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">        <span class='keyword'>bool</span> <span class='keyword'>operator</span>&lt;(<span class='keyword'>const</span> Peer&amp; rhs) <span class='keyword'>const</span> { <span class='keyword'>return</span> std::tie(is_outbound, min_ping) &lt; std::tie(rhs.is_outbound, rhs.min_ping); }</td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">    std::vector&lt;Peer&gt; m_peers;</td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">    std::string ChainToString() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">        <span class='keyword'>switch</span> (gArgs.GetChainType()) {</td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">        <span class='keyword'>case</span> ChainType::TESTNET:</td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">            <span class='keyword'>return</span> <span class='string_literal'>" testnet"</span>;</td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">        <span class='keyword'>case</span> ChainType::SIGNET:</td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">            <span class='keyword'>return</span> <span class='string_literal'>" signet"</span>;</td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">        <span class='keyword'>case</span> ChainType::REGTEST:</td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">            <span class='keyword'>return</span> <span class='string_literal'>" regtest"</span>;</td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">        <span class='keyword'>case</span> ChainType::MAIN:</td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">            <span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">        <span class='macro'>assert(<span class='keyword'>false</span>)<span class='macro_popup'>(static_cast &lt;bool&gt; (false) ? void (0) : __assert_fail (<br>"false", "bitcoin-cli.cpp", 441, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">    std::string PingTimeToString(<span class='keyword'>double</span> seconds) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">        <span class='keyword'>if</span> (seconds &lt; 0) <span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>double</span> milliseconds{round(1000 * seconds)};</td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">        <span class='keyword'>return</span> milliseconds &gt; 999999 ? <span class='string_literal'>"-"</span> : ToString(milliseconds);</td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">    std::string ConnectionTypeForNetinfo(<span class='keyword'>const</span> std::string&amp; conn_type) <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">        <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"outbound-full-relay"</span>) <span class='keyword'>return</span> <span class='string_literal'>"full"</span>;</td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">        <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"block-relay-only"</span>) <span class='keyword'>return</span> <span class='string_literal'>"block"</span>;</td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">        <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"manual"</span> || conn_type == <span class='string_literal'>"feeler"</span>) <span class='keyword'>return</span> conn_type;</td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">        <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"addr-fetch"</span>) <span class='keyword'>return</span> <span class='string_literal'>"addr"</span>;</td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">        <span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>int</span> ID_PEERINFO = 0;</td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>int</span> ID_NETWORKINFO = 1;</td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">    UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) override</td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line">        <span class='keyword'>if</span> (!args.empty()) {</td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line">            uint8_t n{0};</td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line">            <span class='keyword'>if</span> (ParseUInt8(args.at(0), &amp;n)) {</td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line">                m_details_level = std::min(n, MAX_DETAIL_LEVEL);</td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line">                <span class='keyword'>throw</span> std::runtime_error(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"invalid -netinfo argument: %s\nFor more information, run: bitcoin-cli -netinfo help"</span>, args.at(0)));</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line">        UniValue result(UniValue::VARR);</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getpeerinfo"</span>, NullUniValue, ID_PEERINFO));</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line">        result.push_back(JSONRPCRequestObj(<span class='string_literal'>"getnetworkinfo"</span>, NullUniValue, ID_NETWORKINFO));</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line">        <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line">    UniValue ProcessReply(<span class='keyword'>const</span> UniValue&amp; batch_in) override</td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line">        <span class='keyword'>const</span> std::vector&lt;UniValue&gt; batch{JSONRPCProcessBatchReply(batch_in)};</td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_PEERINFO][<span class='string_literal'>"error"</span>].isNull()) <span class='keyword'>return</span> batch[ID_PEERINFO];</td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line">        <span class='keyword'>if</span> (!batch[ID_NETWORKINFO][<span class='string_literal'>"error"</span>].isNull()) <span class='keyword'>return</span> batch[ID_NETWORKINFO];</td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line">        <span class='keyword'>const</span> UniValue&amp; networkinfo{batch[ID_NETWORKINFO][<span class='string_literal'>"result"</span>]};</td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">        <span class='keyword'>if</span> (networkinfo[<span class='string_literal'>"version"</span>].getInt&lt;<span class='keyword'>int</span>&gt;() &lt; 209900) {</td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-netinfo requires bitcoind server to be running v0.21.0 and up"</span>);</td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line">        <span class='keyword'>const</span> int64_t time_now{TicksSinceEpoch&lt;std::chrono::seconds&gt;(CliClock::now())};</td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line">        <span class='comment'>// Count peer connection totals, and if DetailsRequested(), store peer data in a vector of structs.</span></td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; peer : batch[ID_PEERINFO][<span class='string_literal'>"result"</span>].getValues()) {</td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line">            <span class='keyword'>const</span> std::string network{peer[<span class='string_literal'>"network"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">            <span class='keyword'>const</span> int8_t network_id{NetworkStringToId(network)};</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">            <span class='keyword'>if</span> (network_id == UNKNOWN_NETWORK) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">            <span class='keyword'>const</span> <span class='keyword'>bool</span> is_outbound{!peer[<span class='string_literal'>"inbound"</span>].get_bool()};</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">            <span class='keyword'>const</span> <span class='keyword'>bool</span> is_tx_relay{peer[<span class='string_literal'>"relaytxes"</span>].isNull() ? <span class='keyword'>true</span> : peer[<span class='string_literal'>"relaytxes"</span>].get_bool()};</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">            <span class='keyword'>const</span> std::string conn_type{peer[<span class='string_literal'>"connection_type"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line">            ++m_counts.at(is_outbound).at(network_id);      <span class='comment'>// in/out by network</span></td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line">            ++m_counts.at(is_outbound).at(NETWORKS.size()); <span class='comment'>// in/out overall</span></td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">            ++m_counts.at(2).at(network_id);                <span class='comment'>// total by network</span></td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">            ++m_counts.at(2).at(NETWORKS.size());           <span class='comment'>// total overall</span></td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">            <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"block-relay-only"</span>) ++m_block_relay_peers_count;</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">            <span class='keyword'>if</span> (conn_type == <span class='string_literal'>"manual"</span>) ++m_manual_peers_count;</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">            <span class='keyword'>if</span> (DetailsRequested()) {</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">                <span class='comment'>// Push data for this peer to the peers vector.</span></td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>int</span> peer_id{peer[<span class='string_literal'>"id"</span>].getInt&lt;<span class='keyword'>int</span>&gt;()};</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>int</span> mapped_as{peer[<span class='string_literal'>"mapped_as"</span>].isNull() ? 0 : peer[<span class='string_literal'>"mapped_as"</span>].getInt&lt;<span class='keyword'>int</span>&gt;()};</td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>int</span> version{peer[<span class='string_literal'>"version"</span>].getInt&lt;<span class='keyword'>int</span>&gt;()};</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line">                <span class='keyword'>const</span> int64_t addr_processed{peer[<span class='string_literal'>"addr_processed"</span>].isNull() ? 0 : peer[<span class='string_literal'>"addr_processed"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">                <span class='keyword'>const</span> int64_t addr_rate_limited{peer[<span class='string_literal'>"addr_rate_limited"</span>].isNull() ? 0 : peer[<span class='string_literal'>"addr_rate_limited"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">                <span class='keyword'>const</span> int64_t conn_time{peer[<span class='string_literal'>"conntime"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">                <span class='keyword'>const</span> int64_t last_blck{peer[<span class='string_literal'>"last_block"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">                <span class='keyword'>const</span> int64_t last_recv{peer[<span class='string_literal'>"lastrecv"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">                <span class='keyword'>const</span> int64_t last_send{peer[<span class='string_literal'>"lastsend"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">                <span class='keyword'>const</span> int64_t last_trxn{peer[<span class='string_literal'>"last_transaction"</span>].getInt&lt;int64_t&gt;()};</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>double</span> min_ping{peer[<span class='string_literal'>"minping"</span>].isNull() ? -1 : peer[<span class='string_literal'>"minping"</span>].get_real()};</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>double</span> ping{peer[<span class='string_literal'>"pingtime"</span>].isNull() ? -1 : peer[<span class='string_literal'>"pingtime"</span>].get_real()};</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">                <span class='keyword'>const</span> std::string addr{peer[<span class='string_literal'>"addr"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">                <span class='keyword'>const</span> std::string age{conn_time == 0 ? <span class='string_literal'>""</span> : ToString((time_now - conn_time) / 60)};</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line">                <span class='keyword'>const</span> std::string sub_version{peer[<span class='string_literal'>"subver"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line">                <span class='keyword'>const</span> std::string transport{peer[<span class='string_literal'>"transport_protocol_type"</span>].isNull() ? <span class='string_literal'>"v1"</span> : peer[<span class='string_literal'>"transport_protocol_type"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>bool</span> is_addr_relay_enabled{peer[<span class='string_literal'>"addr_relay_enabled"</span>].isNull() ? <span class='keyword'>false</span> : peer[<span class='string_literal'>"addr_relay_enabled"</span>].get_bool()};</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>bool</span> is_bip152_hb_from{peer[<span class='string_literal'>"bip152_hb_from"</span>].get_bool()};</td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line">                <span class='keyword'>const</span> <span class='keyword'>bool</span> is_bip152_hb_to{peer[<span class='string_literal'>"bip152_hb_to"</span>].get_bool()};</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line">                m_peers.push_back({addr, sub_version, conn_type, NETWORK_SHORT_NAMES[network_id], age, transport, min_ping, ping, addr_processed, addr_rate_limited, last_blck, last_recv, last_send, last_trxn, peer_id, mapped_as, version, is_addr_relay_enabled, is_bip152_hb_from, is_bip152_hb_to, is_outbound, is_tx_relay});</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line">                m_max_addr_length = std::max(addr.length() + 1, m_max_addr_length);</td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line">                m_max_addr_processed_length = std::max(ToString(addr_processed).length(), m_max_addr_processed_length);</td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">                m_max_addr_rate_limited_length = std::max(ToString(addr_rate_limited).length(), m_max_addr_rate_limited_length);</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">                m_max_age_length = std::max(age.length(), m_max_age_length);</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">                m_max_id_length = std::max(ToString(peer_id).length(), m_max_id_length);</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">                m_is_asmap_on |= (mapped_as != 0);</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line">        <span class='comment'>// Generate report header.</span></td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">        std::string result{<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%s client %s%s - server %i%s\n\n"</span>, <span class='macro'>PACKAGE_NAME<span class='macro_popup'>"Bitcoin Core"</span></span>, FormatFullVersion(), ChainToString(), networkinfo[<span class='string_literal'>"protocolversion"</span>].getInt&lt;<span class='keyword'>int</span>&gt;(), networkinfo[<span class='string_literal'>"subversion"</span>].get_str())};</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">        <span class='comment'>// Report detailed peer connections list sorted by direction and minimum ping time.</span></td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">        <span class='keyword'>if</span> (DetailsRequested() &amp;&amp; !m_peers.empty()) {</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">            std::sort(m_peers.begin(), m_peers.end());</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"&lt;-&gt;   type   net  v  mping   ping send recv  txn  blk  hb %*s%*s%*s "</span>,</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line">                                m_max_addr_processed_length, <span class='string_literal'>"addrp"</span>,</td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">                                m_max_addr_rate_limited_length, <span class='string_literal'>"addrl"</span>,</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line">                                m_max_age_length, <span class='string_literal'>"age"</span>);</td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">            <span class='keyword'>if</span> (m_is_asmap_on) result += <span class='string_literal'>" asmap "</span>;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%*s %-*s%s\n"</span>, m_max_id_length, <span class='string_literal'>"id"</span>, IsAddressSelected() ? m_max_addr_length : 0, IsAddressSelected() ? <span class='string_literal'>"address"</span> : <span class='string_literal'>""</span>, IsVersionSelected() ? <span class='string_literal'>"version"</span> : <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>const</span> Peer&amp; peer : m_peers) {</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">                std::string version{ToString(peer.version) + peer.sub_version};</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line">                result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(</td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">                    <span class='string_literal'>"%3s %6s %5s %2s%7s%7s%5s%5s%5s%5s  %2s %*s%*s%*s%*i %*s %-*s%s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">                    peer.is_outbound ? <span class='string_literal'>"out"</span> : <span class='string_literal'>"in"</span>,</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">                    ConnectionTypeForNetinfo(peer.conn_type),</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line">                    peer.network,</td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">                    peer.transport_protocol_type.starts_with('v') ? peer.transport_protocol_type[1] : ' ',</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line">                    PingTimeToString(peer.min_ping),</td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">                    PingTimeToString(peer.ping),</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line">                    peer.last_send ? ToString(time_now - peer.last_send) : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line">                    peer.last_recv ? ToString(time_now - peer.last_recv) : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">                    peer.last_trxn ? ToString((time_now - peer.last_trxn) / 60) : peer.is_tx_relay ? <span class='string_literal'>""</span> : <span class='string_literal'>"*"</span>,</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">                    peer.last_blck ? ToString((time_now - peer.last_blck) / 60) : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">                    <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%s%s"</span>, peer.is_bip152_hb_to ? <span class='string_literal'>"."</span> : <span class='string_literal'>" "</span>, peer.is_bip152_hb_from ? <span class='string_literal'>"*"</span> : <span class='string_literal'>" "</span>),</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">                    m_max_addr_processed_length, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">                    peer.addr_processed ? ToString(peer.addr_processed) : peer.is_addr_relay_enabled ? <span class='string_literal'>""</span> : <span class='string_literal'>"."</span>,</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">                    m_max_addr_rate_limited_length, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line">                    peer.addr_rate_limited ? ToString(peer.addr_rate_limited) : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line">                    m_max_age_length, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line">                    peer.age,</td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line">                    m_is_asmap_on ? 7 : 0, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line">                    m_is_asmap_on &amp;&amp; peer.mapped_as ? ToString(peer.mapped_as) : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">                    m_max_id_length, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">                    peer.id,</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line">                    IsAddressSelected() ? m_max_addr_length : 0, <span class='comment'>// variable spacing</span></td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line">                    IsAddressSelected() ? peer.addr : <span class='string_literal'>""</span>,</td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">                    IsVersionSelected() &amp;&amp; version != <span class='string_literal'>"0"</span> ? version : <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"                        ms     ms  sec  sec  min  min                %*s\n\n"</span>, m_max_age_length, <span class='string_literal'>"min"</span>);</td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line">        <span class='comment'>// Report peer connection totals by type.</span></td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line">        result += <span class='string_literal'>"     "</span>;</td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">        std::vector&lt;int8_t&gt; reachable_networks;</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; network : networkinfo[<span class='string_literal'>"networks"</span>].getValues()) {</td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line">            <span class='keyword'>if</span> (network[<span class='string_literal'>"reachable"</span>].get_bool()) {</td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">                <span class='keyword'>const</span> std::string&amp; network_name{network[<span class='string_literal'>"name"</span>].get_str()};</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">                <span class='keyword'>const</span> int8_t network_id{NetworkStringToId(network_name)};</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line">                <span class='keyword'>if</span> (network_id == UNKNOWN_NETWORK) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line">                result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%8s"</span>, network_name); <span class='comment'>// column header</span></td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line">                reachable_networks.push_back(network_id);</td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line">        };</td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> size_t network_id : UNREACHABLE_NETWORK_IDS) {</td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line">            <span class='keyword'>if</span> (m_counts.at(2).at(network_id) == 0) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%8s"</span>, NETWORK_SHORT_NAMES.at(network_id)); <span class='comment'>// column header</span></td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line">            reachable_networks.push_back(network_id);</td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">        result += <span class='string_literal'>"   total   block"</span>;</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line">        <span class='keyword'>if</span> (m_manual_peers_count) result += <span class='string_literal'>"  manual"</span>;</td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">        <span class='keyword'>const</span> std::array rows{<span class='string_literal'>"in"</span>, <span class='string_literal'>"out"</span>, <span class='string_literal'>"total"</span>};</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">        <span class='keyword'>for</span> (size_t i = 0; i &lt; rows.size(); ++i) {</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"\n%-5s"</span>, rows[i]); <span class='comment'>// row header</span></td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line">            <span class='keyword'>for</span> (int8_t n : reachable_networks) {</td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line">                result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%8i"</span>, m_counts.at(i).at(n)); <span class='comment'>// network peers count</span></td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line">            result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"   %5i"</span>, m_counts.at(i).at(NETWORKS.size())); <span class='comment'>// total peers count</span></td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line">            <span class='keyword'>if</span> (i == 1) { <span class='comment'>// the outbound row has two extra columns for block relay and manual peer counts</span></td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">                result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"   %5i"</span>, m_block_relay_peers_count);</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">                <span class='keyword'>if</span> (m_manual_peers_count) result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"   %5i"</span>, m_manual_peers_count);</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line">        <span class='comment'>// Report local addresses, ports, and scores.</span></td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">        result += <span class='string_literal'>"\n\nLocal addresses"</span>;</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">        <span class='keyword'>const</span> std::vector&lt;UniValue&gt;&amp; local_addrs{networkinfo[<span class='string_literal'>"localaddresses"</span>].getValues()};</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line">        <span class='keyword'>if</span> (local_addrs.empty()) {</td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line">            result += <span class='string_literal'>": n/a\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">            size_t max_addr_size{0};</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; addr : local_addrs) {</td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line">                max_addr_size = std::max(addr[<span class='string_literal'>"address"</span>].get_str().length() + 1, max_addr_size);</td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line">            <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; addr : local_addrs) {</td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line">                result += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"\n%-*s    port %6i    score %6i"</span>, max_addr_size, addr[<span class='string_literal'>"address"</span>].get_str(), addr[<span class='string_literal'>"port"</span>].getInt&lt;<span class='keyword'>int</span>&gt;(), addr[<span class='string_literal'>"score"</span>].getInt&lt;<span class='keyword'>int</span>&gt;());</td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line">        <span class='keyword'>return</span> JSONRPCReplyObj(UniValue{result}, NullUniValue, 1);</td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line">    <span class='keyword'>const</span> std::string m_help_doc{</td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line">        <span class='string_literal'>"-netinfo level|\"help\" \n\n"</span></td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line">        <span class='string_literal'>"Returns a network peer connections dashboard with information from the remote server.\n"</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line">        <span class='string_literal'>"This human-readable interface will change regularly and is not intended to be a stable API.\n"</span></td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line">        <span class='string_literal'>"Under the hood, -netinfo fetches the data by calling getpeerinfo and getnetworkinfo.\n"</span></td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line">        + <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"An optional integer argument from 0 to %d can be passed for different peers listings; %d to 255 are parsed as %d.\n"</span>, MAX_DETAIL_LEVEL, MAX_DETAIL_LEVEL, MAX_DETAIL_LEVEL) +</td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line">        <span class='string_literal'>"Pass \"help\" to see this detailed help documentation.\n"</span></td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line">        <span class='string_literal'>"If more than one argument is passed, only the first one is read and parsed.\n"</span></td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">        <span class='string_literal'>"Suggestion: use with the Linux watch(1) command for a live dashboard; see example below.\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line">        <span class='string_literal'>"Arguments:\n"</span></td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line">        + <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"1. level (integer 0-%d, optional)  Specify the info level of the peers dashboard (default 0):\n"</span>, MAX_DETAIL_LEVEL) +</td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line">        <span class='string_literal'>"                                  0 - Peer counts for each reachable network as well as for block relay peers\n"</span></td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line">        <span class='string_literal'>"                                      and manual peers, and the list of local addresses and ports\n"</span></td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">        <span class='string_literal'>"                                  1 - Like 0 but preceded by a peers listing (without address and version columns)\n"</span></td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">        <span class='string_literal'>"                                  2 - Like 1 but with an address column\n"</span></td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line">        <span class='string_literal'>"                                  3 - Like 1 but with a version column\n"</span></td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line">        <span class='string_literal'>"                                  4 - Like 1 but with both address and version columns\n"</span></td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line">        <span class='string_literal'>"2. help (string \"help\", optional) Print this help documentation instead of the dashboard.\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line">        <span class='string_literal'>"Result:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">        + <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"* The peers listing in levels 1-%d displays all of the peers sorted by direction and minimum ping time:\n\n"</span>, MAX_DETAIL_LEVEL) +</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line">        <span class='string_literal'>"  Column   Description\n"</span></td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line">        <span class='string_literal'>"  ------   -----------\n"</span></td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line">        <span class='string_literal'>"  &lt;-&gt;      Direction\n"</span></td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line">        <span class='string_literal'>"           \"in\"  - inbound connections are those initiated by the peer\n"</span></td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">        <span class='string_literal'>"           \"out\" - outbound connections are those initiated by us\n"</span></td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line">        <span class='string_literal'>"  type     Type of peer connection\n"</span></td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line">        <span class='string_literal'>"           \"full\"   - full relay, the default\n"</span></td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line">        <span class='string_literal'>"           \"block\"  - block relay; like full relay but does not relay transactions or addresses\n"</span></td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line">        <span class='string_literal'>"           \"manual\" - peer we manually added using RPC addnode or the -addnode/-connect config options\n"</span></td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">        <span class='string_literal'>"           \"feeler\" - short-lived connection for testing addresses\n"</span></td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">        <span class='string_literal'>"           \"addr\"   - address fetch; short-lived connection for requesting addresses\n"</span></td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line">        <span class='string_literal'>"  net      Network the peer connected through (\"ipv4\", \"ipv6\", \"onion\", \"i2p\", \"cjdns\", or \"npr\" (not publicly routable))\n"</span></td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line">        <span class='string_literal'>"  v        Version of transport protocol used for the connection\n"</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line">        <span class='string_literal'>"  mping    Minimum observed ping time, in milliseconds (ms)\n"</span></td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">        <span class='string_literal'>"  ping     Last observed ping time, in milliseconds (ms)\n"</span></td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line">        <span class='string_literal'>"  send     Time since last message sent to the peer, in seconds\n"</span></td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line">        <span class='string_literal'>"  recv     Time since last message received from the peer, in seconds\n"</span></td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line">        <span class='string_literal'>"  txn      Time since last novel transaction received from the peer and accepted into our mempool, in minutes\n"</span></td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line">        <span class='string_literal'>"           \"*\" - we do not relay transactions to this peer (relaytxes is false)\n"</span></td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line">        <span class='string_literal'>"  blk      Time since last novel block passing initial validity checks received from the peer, in minutes\n"</span></td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">        <span class='string_literal'>"  hb       High-bandwidth BIP152 compact block relay\n"</span></td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line">        <span class='string_literal'>"           \".\" (to)   - we selected the peer as a high-bandwidth peer\n"</span></td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line">        <span class='string_literal'>"           \"*\" (from) - the peer selected us as a high-bandwidth peer\n"</span></td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line">        <span class='string_literal'>"  addrp    Total number of addresses processed, excluding those dropped due to rate limiting\n"</span></td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line">        <span class='string_literal'>"           \".\" - we do not relay addresses to this peer (addr_relay_enabled is false)\n"</span></td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line">        <span class='string_literal'>"  addrl    Total number of addresses dropped due to rate limiting\n"</span></td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line">        <span class='string_literal'>"  age      Duration of connection to the peer, in minutes\n"</span></td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line">        <span class='string_literal'>"  asmap    Mapped AS (Autonomous System) number in the BGP route to the peer, used for diversifying\n"</span></td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line">        <span class='string_literal'>"           peer selection (only displayed if the -asmap config option is set)\n"</span></td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line">        <span class='string_literal'>"  id       Peer index, in increasing order of peer connections since node startup\n"</span></td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line">        <span class='string_literal'>"  address  IP address and port of the peer\n"</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line">        <span class='string_literal'>"  version  Peer version and subversion concatenated, e.g. \"70016/Satoshi:21.0.0/\"\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line">        <span class='string_literal'>"* The peer counts table displays the number of peers for each reachable network as well as\n"</span></td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line">        <span class='string_literal'>"  the number of block relay peers and manual peers.\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line">        <span class='string_literal'>"* The local addresses table lists each local address broadcast by the node, the port, and the score.\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line">        <span class='string_literal'>"Examples:\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line">        <span class='string_literal'>"Peer counts table of reachable networks and list of local addresses\n"</span></td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line">        <span class='string_literal'>"&gt; bitcoin-cli -netinfo\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">        <span class='string_literal'>"The same, preceded by a peers listing without address and version columns\n"</span></td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">        <span class='string_literal'>"&gt; bitcoin-cli -netinfo 1\n\n"</span></td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">        <span class='string_literal'>"Full dashboard\n"</span></td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">        + <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"&gt; bitcoin-cli -netinfo %d\n\n"</span>, MAX_DETAIL_LEVEL) +</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">        <span class='string_literal'>"Full live dashboard, adjust --interval or --no-title as needed (Linux)\n"</span></td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">        + <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"&gt; watch --interval 1 --no-title bitcoin-cli -netinfo %d\n\n"</span>, MAX_DETAIL_LEVEL) +</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line">        <span class='string_literal'>"See this help\n"</span></td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line">        <span class='string_literal'>"&gt; bitcoin-cli -netinfo help\n"</span>};</td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line"><span class='comment'>/** Process RPC generatetoaddress request. */</span></td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"><span class='keyword'>class</span> GenerateToAddressRequestHandler : <span class='keyword'>public</span> BaseRequestHandler</td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line">    UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) override</td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line">        address_str = args.at(1);</td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line">        UniValue params{RPCConvertValues(<span class='string_literal'>"generatetoaddress"</span>, args)};</td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line">        <span class='keyword'>return</span> JSONRPCRequestObj(<span class='string_literal'>"generatetoaddress"</span>, params, 1);</td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line">    UniValue ProcessReply(<span class='keyword'>const</span> UniValue &amp;reply) override</td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line">        UniValue result(UniValue::VOBJ);</td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line">        result.pushKV(<span class='string_literal'>"address"</span>, address_str);</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line">        result.pushKV(<span class='string_literal'>"blocks"</span>, reply.get_obj()[<span class='string_literal'>"result"</span>]);</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line">        <span class='keyword'>return</span> JSONRPCReplyObj(result, NullUniValue, 1);</td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line"><span class='keyword'>protected</span>:</td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line">    std::string address_str;</td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line"><span class='comment'>/** Process default single requests */</span></td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line"><span class='keyword'>class</span> DefaultRequestHandler: <span class='keyword'>public</span> BaseRequestHandler {</td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">    UniValue PrepareRequest(<span class='keyword'>const</span> std::string&amp; method, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args) override</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">        UniValue params;</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">        <span class='keyword'>if</span>(gArgs.GetBoolArg(<span class='string_literal'>"-named"</span>, DEFAULT_NAMED)) {</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">            params = RPCConvertNamedValues(method, args);</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">            params = RPCConvertValues(method, args);</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line">        <span class='keyword'>return</span> JSONRPCRequestObj(method, params, 1);</td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line">    UniValue ProcessReply(<span class='keyword'>const</span> UniValue &amp;reply) override</td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line">        <span class='keyword'>return</span> reply.get_obj();</td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line"><span class='keyword'>static</span> UniValue CallRPC(BaseRequestHandler* rh, <span class='keyword'>const</span> std::string&amp; strMethod, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args, <span class='keyword'>const</span> std::optional&lt;std::string&gt;&amp; rpcwallet = {})</td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">    std::string host;</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">    <span class='comment'>// In preference order, we choose the following for the port:</span></td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">    <span class='comment'>//     1. -rpcport</span></td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line">    <span class='comment'>//     2. port in -rpcconnect (ie following : in ipv4 or ]: in ipv6)</span></td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line">    <span class='comment'>//     3. default port for chain</span></td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">    uint16_t port{BaseParams().RPCPort()};</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">    SplitHostPort(gArgs.GetArg(<span class='string_literal'>"-rpcconnect"</span>, DEFAULT_RPCCONNECT), port, host);</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">    port = <span class='keyword'>static_cast</span>&lt;uint16_t&gt;(gArgs.GetIntArg(<span class='string_literal'>"-rpcport"</span>, port));</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line">    <span class='comment'>// Obtain event base</span></td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line">    raii_event_base base = obtain_event_base();</td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line">    <span class='comment'>// Synchronously look up hostname</span></td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line">    raii_evhttp_connection evcon = obtain_evhttp_connection_base(base.get(), host, port);</td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">    <span class='comment'>// Set connection timeout</span></td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line">        <span class='keyword'>const</span> <span class='keyword'>int</span> timeout = gArgs.GetIntArg(<span class='string_literal'>"-rpcclienttimeout"</span>, DEFAULT_HTTP_CLIENT_TIMEOUT);</td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">        <span class='keyword'>if</span> (timeout &gt; 0) {</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">            evhttp_connection_set_timeout(evcon.get(), timeout);</td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line">            <span class='comment'>// Indefinite request timeouts are not possible in libevent-http, so we</span></td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line">            <span class='comment'>// set the timeout to a very long time period instead.</span></td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">            <span class='keyword'>constexpr</span> <span class='keyword'>int</span> YEAR_IN_SECONDS = 31556952; <span class='comment'>// Average length of year in Gregorian calendar</span></td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">            evhttp_connection_set_timeout(evcon.get(), 5 * YEAR_IN_SECONDS);</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">    HTTPReply response;</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line">    raii_evhttp_request req = obtain_evhttp_request(http_request_done, (<span class='keyword'>void</span>*)&amp;response);</td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line">    <span class='keyword'>if</span> (req == <span class='keyword'>nullptr</span>) {</td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"create http request failed"</span>);</td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line">    evhttp_request_set_error_cb(req.get(), http_error_cb);</td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line">    <span class='comment'>// Get credentials</span></td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line">    std::string strRPCUserColonPass;</td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">    <span class='keyword'>bool</span> failedToGetAuthCookie = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">    <span class='keyword'>if</span> (gArgs.GetArg(<span class='string_literal'>"-rpcpassword"</span>, <span class='string_literal'>""</span>) == <span class='string_literal'>""</span>) {</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">        <span class='comment'>// Try fall back to cookie-based authentication if no password is provided</span></td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line">        <span class='keyword'>if</span> (!GetAuthCookie(&amp;strRPCUserColonPass)) {</td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line">            failedToGetAuthCookie = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line">        strRPCUserColonPass = gArgs.GetArg(<span class='string_literal'>"-rpcuser"</span>, <span class='string_literal'>""</span>) + <span class='string_literal'>":"</span> + gArgs.GetArg(<span class='string_literal'>"-rpcpassword"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line">    <span class='keyword'>struct</span> evkeyvalq* output_headers = evhttp_request_get_output_headers(req.get());</td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line">    <span class='macro'>assert(output_headers)<span class='macro_popup'>(static_cast &lt;bool&gt; (output_headers) ? void (0) : __assert_fail<br> ("output_headers", "bitcoin-cli.cpp", 794, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line">    evhttp_add_header(output_headers, <span class='string_literal'>"Host"</span>, host.c_str());</td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line">    evhttp_add_header(output_headers, <span class='string_literal'>"Connection"</span>, <span class='string_literal'>"close"</span>);</td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">    evhttp_add_header(output_headers, <span class='string_literal'>"Content-Type"</span>, <span class='string_literal'>"application/json"</span>);</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">    evhttp_add_header(output_headers, <span class='string_literal'>"Authorization"</span>, (std::string(<span class='string_literal'>"Basic "</span>) + EncodeBase64(strRPCUserColonPass)).c_str());</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">    <span class='comment'>// Attach request data</span></td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">    std::string strRequest = rh-&gt;PrepareRequest(strMethod, args).write() + <span class='string_literal'>"\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">    <span class='keyword'>struct</span> evbuffer* output_buffer = evhttp_request_get_output_buffer(req.get());</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">    <span class='macro'>assert(output_buffer)<span class='macro_popup'>(static_cast &lt;bool&gt; (output_buffer) ? void (0) : __assert_fail<br> ("output_buffer", "bitcoin-cli.cpp", 803, __extension__ __PRETTY_FUNCTION__<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">    evbuffer_add(output_buffer, strRequest.data(), strRequest.size());</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">    <span class='comment'>// check if we should use a special wallet endpoint</span></td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line">    std::string endpoint = <span class='string_literal'>"/"</span>;</td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line">    <span class='keyword'>if</span> (rpcwallet) {</td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line">        <span class='keyword'>char</span>* encodedURI = evhttp_uriencode(rpcwallet-&gt;data(), rpcwallet-&gt;size(), <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line">        <span class='keyword'>if</span> (encodedURI) {</td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line">            endpoint = <span class='string_literal'>"/wallet/"</span> + std::string(encodedURI);</td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line">            free(encodedURI);</td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line">            <span class='keyword'>throw</span> CConnectionFailed(<span class='string_literal'>"uri-encode failed"</span>);</td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line">    <span class='keyword'>int</span> r = evhttp_make_request(evcon.get(), req.get(), EVHTTP_REQ_POST, endpoint.c_str());</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line">    req.release(); <span class='comment'>// ownership moved to evcon in above call</span></td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line">    <span class='keyword'>if</span> (r != 0) {</td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line">        <span class='keyword'>throw</span> CConnectionFailed(<span class='string_literal'>"send http request failed"</span>);</td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line">    event_base_dispatch(base.get());</td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line">    <span class='keyword'>if</span> (response.status == 0) {</td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line">        std::string responseErrorMessage;</td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line">        <span class='keyword'>if</span> (response.error != -1) {</td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line">            responseErrorMessage = <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>" (error code %d - \"%s\")"</span>, response.error, http_errorstring(response.error));</td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line">        <span class='keyword'>throw</span> CConnectionFailed(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Could not connect to the server %s:%d%s\n\nMake sure the bitcoind server is running and that you are connecting to the correct RPC port."</span>, host, port, responseErrorMessage));</td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (response.status == HTTP_UNAUTHORIZED) {</td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line">        <span class='keyword'>if</span> (failedToGetAuthCookie) {</td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line">                <span class='string_literal'>"Could not locate RPC credentials. No authentication cookie could be found, and RPC password is not set.  See -rpcpassword and -stdinrpcpass.  Configuration file: (%s)"</span>,</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line">                fs::PathToString(gArgs.GetConfigFilePath())));</td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"Authorization failed: Incorrect rpcuser or rpcpassword"</span>);</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (response.status == HTTP_SERVICE_UNAVAILABLE) {</td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Server response: %s"</span>, response.body));</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (response.status &gt;= 400 &amp;&amp; response.status != HTTP_BAD_REQUEST &amp;&amp; response.status != HTTP_NOT_FOUND &amp;&amp; response.status != HTTP_INTERNAL_SERVER_ERROR)</td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"server returned HTTP error %d"</span>, response.status));</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (response.body.empty())</td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"no response from server"</span>);</td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line">    <span class='comment'>// Parse reply</span></td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line">    UniValue valReply(UniValue::VSTR);</td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line">    <span class='keyword'>if</span> (!valReply.read(response.body))</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"couldn't parse reply from server"</span>);</td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line">    UniValue reply = rh-&gt;ProcessReply(valReply);</td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line">    <span class='keyword'>if</span> (reply.empty())</td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"expected reply to have result, error and id properties"</span>);</td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">    <span class='keyword'>return</span> reply;</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line"> <span class='comment'>* ConnectAndCallRPC wraps CallRPC with -rpcwait and an exception handler.</span></td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line"> <span class='comment'>* @param[in] rh         Pointer to RequestHandler.</span></td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"> <span class='comment'>* @param[in] strMethod  Reference to const string method to forward to CallRPC.</span></td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line"> <span class='comment'>* @param[in] rpcwallet  Reference to const optional string wallet name to forward to CallRPC.</span></td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line"> <span class='comment'>* @returns the RPC response as a UniValue object.</span></td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line"> <span class='comment'>* @throws a CConnectionFailed std::runtime_error if connection failed or RPC server still in warmup.</span></td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line"><span class='keyword'>static</span> UniValue ConnectAndCallRPC(BaseRequestHandler* rh, <span class='keyword'>const</span> std::string&amp; strMethod, <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; args, <span class='keyword'>const</span> std::optional&lt;std::string&gt;&amp; rpcwallet = {})</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line">    UniValue response(UniValue::VOBJ);</td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line">    <span class='comment'>// Execute and handle connection failures with -rpcwait.</span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>bool</span> fWait = gArgs.GetBoolArg(<span class='string_literal'>"-rpcwait"</span>, <span class='keyword'>false</span>);</td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>int</span> timeout = gArgs.GetIntArg(<span class='string_literal'>"-rpcwaittimeout"</span>, DEFAULT_WAIT_CLIENT_TIMEOUT);</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> deadline{std::chrono::steady_clock::now() + 1s * timeout};</td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">    <span class='keyword'>do</span> {</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">        <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">            response = CallRPC(rh, strMethod, args, rpcwallet);</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">            <span class='keyword'>if</span> (fWait) {</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line">                <span class='keyword'>const</span> UniValue&amp; error = response.find_value(<span class='string_literal'>"error"</span>);</td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">                <span class='keyword'>if</span> (!error.isNull() &amp;&amp; error[<span class='string_literal'>"code"</span>].getInt&lt;<span class='keyword'>int</span>&gt;() == RPC_IN_WARMUP) {</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">                    <span class='keyword'>throw</span> CConnectionFailed(<span class='string_literal'>"server in warmup"</span>);</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">            <span class='keyword'>break</span>; <span class='comment'>// Connection succeeded, no need to retry.</span></td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">        } <span class='keyword'>catch</span> (<span class='keyword'>const</span> CConnectionFailed&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">            <span class='keyword'>if</span> (fWait &amp;&amp; (timeout &lt;= 0 || std::chrono::steady_clock::now() &lt; deadline)) {</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">                UninterruptibleSleep(1s);</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">                <span class='keyword'>throw</span> CConnectionFailed(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"timeout on transient error: %s"</span>, e.what()));</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">    } <span class='keyword'>while</span> (fWait);</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">    <span class='keyword'>return</span> response;</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line"><span class='comment'>/** Parse UniValue result to update the message to print to std::cout. */</span></td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ParseResult(<span class='keyword'>const</span> UniValue&amp; result, std::string&amp; strPrint)</td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line">    <span class='keyword'>if</span> (result.isNull()) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line">    strPrint = result.isStr() ? result.get_str() : result.write(2);</td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line"><span class='comment'>/** Parse UniValue error to update the message to print to std::cerr and the code to return. */</span></td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ParseError(<span class='keyword'>const</span> UniValue&amp; error, std::string&amp; strPrint, <span class='keyword'>int</span>&amp; nRet)</td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">    <span class='keyword'>if</span> (error.isObject()) {</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line">        <span class='keyword'>const</span> UniValue&amp; err_code = error.find_value(<span class='string_literal'>"code"</span>);</td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line">        <span class='keyword'>const</span> UniValue&amp; err_msg = error.find_value(<span class='string_literal'>"message"</span>);</td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line">        <span class='keyword'>if</span> (!err_code.isNull()) {</td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">            strPrint = <span class='string_literal'>"error code: "</span> + err_code.getValStr() + <span class='string_literal'>"\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">        <span class='keyword'>if</span> (err_msg.isStr()) {</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">            strPrint += (<span class='string_literal'>"error message:\n"</span> + err_msg.get_str());</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line">        <span class='keyword'>if</span> (err_code.isNum() &amp;&amp; err_code.getInt&lt;<span class='keyword'>int</span>&gt;() == RPC_WALLET_NOT_SPECIFIED) {</td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line">            strPrint += <span class='string_literal'>"\nTry adding \"-rpcwallet=&lt;filename&gt;\" option to bitcoin-cli command line."</span>;</td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line">        strPrint = <span class='string_literal'>"error: "</span> + error.write();</td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">    nRet = abs(error[<span class='string_literal'>"code"</span>].getInt&lt;<span class='keyword'>int</span>&gt;());</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line"> <span class='comment'>* GetWalletBalances calls listwallets; if more than one wallet is loaded, it then</span></td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line"> <span class='comment'>* fetches mine.trusted balances for each loaded wallet and pushes them to `result`.</span></td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line"> <span class='comment'>* @param result  Reference to UniValue object the wallet names and balances are pushed to.</span></td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> GetWalletBalances(UniValue&amp; result)</td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line">    DefaultRequestHandler rh;</td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line">    <span class='keyword'>const</span> UniValue listwallets = ConnectAndCallRPC(&amp;rh, <span class='string_literal'>"listwallets"</span>, <span class='comment'>/* args=*/</span>{});</td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line">    <span class='keyword'>if</span> (!listwallets.find_value(<span class='string_literal'>"error"</span>).isNull()) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; wallets = listwallets.find_value(<span class='string_literal'>"result"</span>);</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line">    <span class='keyword'>if</span> (wallets.size() &lt;= 1) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line">    UniValue balances(UniValue::VOBJ);</td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; wallet : wallets.getValues()) {</td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line">        <span class='keyword'>const</span> std::string&amp; wallet_name = wallet.get_str();</td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line">        <span class='keyword'>const</span> UniValue getbalances = ConnectAndCallRPC(&amp;rh, <span class='string_literal'>"getbalances"</span>, <span class='comment'>/* args=*/</span>{}, wallet_name);</td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line">        <span class='keyword'>const</span> UniValue&amp; balance = getbalances.find_value(<span class='string_literal'>"result"</span>)[<span class='string_literal'>"mine"</span>][<span class='string_literal'>"trusted"</span>];</td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line">        balances.pushKV(wallet_name, balance);</td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">    result.pushKV(<span class='string_literal'>"balances"</span>, balances);</td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line"> <span class='comment'>* GetProgressBar constructs a progress bar with 5% intervals.</span></td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line"> <span class='comment'>* @param[in]   progress      The proportion of the progress bar to be filled between 0 and 1.</span></td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line"> <span class='comment'>* @param[out]  progress_bar  String representation of the progress bar.</span></td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> GetProgressBar(<span class='keyword'>double</span> progress, std::string&amp; progress_bar)</td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line">    <span class='keyword'>if</span> (progress &lt; 0 || progress &gt; 1) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>double</span> INCREMENT{0.05};</td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> std::string COMPLETE_BAR{<span class='string_literal'>"\u2592"</span>};</td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> std::string INCOMPLETE_BAR{<span class='string_literal'>"\u2591"</span>};</td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; i &lt; progress / INCREMENT; ++i) {</td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line">        progress_bar += COMPLETE_BAR;</td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>int</span> i = 0; i &lt; (1 - progress) / INCREMENT; ++i) {</td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line">        progress_bar += INCOMPLETE_BAR;</td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line"> <span class='comment'>* ParseGetInfoResult takes in -getinfo result in UniValue object and parses it</span></td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line"> <span class='comment'>* into a user friendly UniValue string to be printed on the console.</span></td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line"> <span class='comment'>* @param[out] result  Reference to UniValue result containing the -getinfo output.</span></td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> ParseGetInfoResult(UniValue&amp; result)</td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line">    <span class='keyword'>if</span> (!result.find_value(<span class='string_literal'>"error"</span>).isNull()) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">    std::string RESET, GREEN, BLUE, YELLOW, MAGENTA, CYAN;</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">    <span class='keyword'>bool</span> should_colorize = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line"><span class='directive'>#ifndef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">    <span class='keyword'>if</span> (isatty(fileno(<span class='macro'>stdout<span class='macro_popup'>stdout</span></span>))) {</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">        <span class='comment'>// By default, only print colored text if OS is not WIN32 and stdout is connected to a terminal.</span></td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">        should_colorize = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">    <span class='keyword'>if</span> (gArgs.IsArgSet(<span class='string_literal'>"-color"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">        <span class='keyword'>const</span> std::string color{gArgs.GetArg(<span class='string_literal'>"-color"</span>, DEFAULT_COLOR_SETTING)};</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">        <span class='keyword'>if</span> (color == <span class='string_literal'>"always"</span>) {</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line">            should_colorize = <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (color == <span class='string_literal'>"never"</span>) {</td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">            should_colorize = <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (color != <span class='string_literal'>"auto"</span>) {</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">            <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"Invalid value for -color option. Valid values: always, auto, never."</span>);</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">    <span class='keyword'>if</span> (should_colorize) {</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">        RESET = <span class='string_literal'>"\x1B[0m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">        GREEN = <span class='string_literal'>"\x1B[32m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line">        BLUE = <span class='string_literal'>"\x1B[34m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line">        YELLOW = <span class='string_literal'>"\x1B[33m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">        MAGENTA = <span class='string_literal'>"\x1B[35m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">        CYAN = <span class='string_literal'>"\x1B[36m"</span>;</td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line">    std::string result_string = <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%sChain: %s%s\n"</span>, BLUE, result[<span class='string_literal'>"chain"</span>].getValStr(), RESET);</td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Blocks: %s\n"</span>, result[<span class='string_literal'>"blocks"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Headers: %s\n"</span>, result[<span class='string_literal'>"headers"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>double</span> ibd_progress{result[<span class='string_literal'>"verificationprogress"</span>].get_real()};</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line">    std::string ibd_progress_bar;</td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line">    <span class='comment'>// Display the progress bar only if IBD progress is less than 99%</span></td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">    <span class='keyword'>if</span> (ibd_progress &lt; 0.99) {</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">      GetProgressBar(ibd_progress, ibd_progress_bar);</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">      <span class='comment'>// Add padding between progress bar and IBD progress</span></td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line">      ibd_progress_bar += <span class='string_literal'>" "</span>;</td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Verification progress: %s%.4f%%\n"</span>, ibd_progress_bar, ibd_progress * 100);</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Difficulty: %s\n\n"</span>, result[<span class='string_literal'>"difficulty"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">        <span class='string_literal'>"%sNetwork: in %s, out %s, total %s%s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">        GREEN,</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">        result[<span class='string_literal'>"connections"</span>][<span class='string_literal'>"in"</span>].getValStr(),</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line">        result[<span class='string_literal'>"connections"</span>][<span class='string_literal'>"out"</span>].getValStr(),</td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">        result[<span class='string_literal'>"connections"</span>][<span class='string_literal'>"total"</span>].getValStr(),</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">        RESET);</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Version: %s\n"</span>, result[<span class='string_literal'>"version"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Time offset (s): %s\n"</span>, result[<span class='string_literal'>"timeoffset"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">    <span class='comment'>// proxies</span></td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">    std::map&lt;std::string, std::vector&lt;std::string&gt;&gt; proxy_networks;</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">    std::vector&lt;std::string&gt; ordered_proxies;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> UniValue&amp; network : result[<span class='string_literal'>"networks"</span>].getValues()) {</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">        <span class='keyword'>const</span> std::string proxy = network[<span class='string_literal'>"proxy"</span>].getValStr();</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line">        <span class='keyword'>if</span> (proxy.empty()) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">        <span class='comment'>// Add proxy to ordered_proxy if has not been processed</span></td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">        <span class='keyword'>if</span> (proxy_networks.find(proxy) == proxy_networks.end()) ordered_proxies.push_back(proxy);</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line">        proxy_networks[proxy].push_back(network[<span class='string_literal'>"name"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">    std::vector&lt;std::string&gt; formatted_proxies;</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">    formatted_proxies.reserve(ordered_proxies.size());</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">    <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; proxy : ordered_proxies) {</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">        formatted_proxies.emplace_back(<span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%s (%s)"</span>, proxy, Join(proxy_networks.find(proxy)-&gt;second, <span class='string_literal'>", "</span>)));</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Proxies: %s\n"</span>, formatted_proxies.empty() ? <span class='string_literal'>"n/a"</span> : Join(formatted_proxies, <span class='string_literal'>", "</span>));</td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Min tx relay fee rate (%s/kvB): %s\n\n"</span>, CURRENCY_UNIT, result[<span class='string_literal'>"relayfee"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line">    <span class='keyword'>if</span> (!result[<span class='string_literal'>"has_wallet"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">        <span class='keyword'>const</span> std::string walletname = result[<span class='string_literal'>"walletname"</span>].getValStr();</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">        result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%sWallet: %s%s\n"</span>, MAGENTA, walletname.empty() ? <span class='string_literal'>"\"\""</span> : walletname, RESET);</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">        result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Keypool size: %s\n"</span>, result[<span class='string_literal'>"keypoolsize"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">        <span class='keyword'>if</span> (!result[<span class='string_literal'>"unlocked_until"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">            result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Unlocked until: %s\n"</span>, result[<span class='string_literal'>"unlocked_until"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line">        result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"Transaction fee rate (-paytxfee) (%s/kvB): %s\n\n"</span>, CURRENCY_UNIT, result[<span class='string_literal'>"paytxfee"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">    <span class='keyword'>if</span> (!result[<span class='string_literal'>"balance"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">        result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%sBalance:%s %s\n\n"</span>, CYAN, RESET, result[<span class='string_literal'>"balance"</span>].getValStr());</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">    <span class='keyword'>if</span> (!result[<span class='string_literal'>"balances"</span>].isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">        result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%sBalances%s\n"</span>, CYAN, RESET);</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">        size_t max_balance_length{10};</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; wallet : result[<span class='string_literal'>"balances"</span>].getKeys()) {</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">            max_balance_length = std::max(result[<span class='string_literal'>"balances"</span>][wallet].getValStr().length(), max_balance_length);</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">        <span class='keyword'>for</span> (<span class='keyword'>const</span> std::string&amp; wallet : result[<span class='string_literal'>"balances"</span>].getKeys()) {</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">            result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%*s %s\n"</span>,</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">                                       max_balance_length,</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">                                       result[<span class='string_literal'>"balances"</span>][wallet].getValStr(),</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line">                                       wallet.empty() ? <span class='string_literal'>"\"\""</span> : wallet);</td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">        result_string += <span class='string_literal'>"\n"</span>;</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">    <span class='keyword'>const</span> std::string warnings{result[<span class='string_literal'>"warnings"</span>].getValStr()};</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">    result_string += <span class='macro'>strprintf<span class='macro_popup'>tfm::format</span></span>(<span class='string_literal'>"%sWarnings:%s %s"</span>, YELLOW, RESET, warnings.empty() ? <span class='string_literal'>"(none)"</span> : warnings);</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">    result.setStr(result_string);</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line"> <span class='comment'>* Call RPC getnewaddress.</span></td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line"> <span class='comment'>* @returns getnewaddress response as a UniValue object.</span></td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line"><span class='keyword'>static</span> UniValue GetNewAddress()</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">    std::optional&lt;std::string&gt; wallet_name{};</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">    <span class='keyword'>if</span> (gArgs.IsArgSet(<span class='string_literal'>"-rpcwallet"</span>)) wallet_name = gArgs.GetArg(<span class='string_literal'>"-rpcwallet"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">    DefaultRequestHandler rh;</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">    <span class='keyword'>return</span> ConnectAndCallRPC(&amp;rh, <span class='string_literal'>"getnewaddress"</span>, <span class='comment'>/* args=*/</span>{}, wallet_name);</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line"> <span class='comment'>* Check bounds and set up args for RPC generatetoaddress params: nblocks, address, maxtries.</span></td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line"> <span class='comment'>* @param[in] address  Reference to const string address to insert into the args.</span></td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line"> <span class='comment'>* @param     args     Reference to vector of string args to modify.</span></td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> SetGenerateToAddressArgs(<span class='keyword'>const</span> std::string&amp; address, std::vector&lt;std::string&gt;&amp; args)</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line">    <span class='keyword'>if</span> (args.size() &gt; 2) <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"too many arguments (maximum 2 for nblocks and maxtries)"</span>);</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">    <span class='keyword'>if</span> (args.size() == 0) {</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">        args.emplace_back(DEFAULT_NBLOCKS);</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (args.at(0) == <span class='string_literal'>"0"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"the first argument (number of blocks to generate, default: "</span> + DEFAULT_NBLOCKS + <span class='string_literal'>") must be an integer value greater than zero"</span>);</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">    args.emplace(args.begin() + 1, address);</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> CommandLineRPC(<span class='keyword'>int</span> argc, <span class='keyword'>char</span> *argv[])</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">    std::string strPrint;</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">    <span class='keyword'>int</span> nRet = 0;</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">    <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">        <span class='comment'>// Skip switches</span></td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">        <span class='keyword'>while</span> (argc &gt; 1 &amp;&amp; IsSwitchChar(argv[1][0])) {</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">            argc--;</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line">            argv++;</td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">        std::string rpcPass;</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">        <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-stdinrpcpass"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">            <span class='macro'>NO_STDIN_ECHO()<span class='macro_popup'>NoechoInst _no_echo</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">            <span class='keyword'>if</span> (!StdinReady()) {</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line">                fputs(<span class='string_literal'>"RPC password&gt; "</span>, <span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">                fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line">            <span class='keyword'>if</span> (!std::getline(std::cin, rpcPass)) {</td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">                <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-stdinrpcpass specified but failed to read from standard input"</span>);</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">            <span class='keyword'>if</span> (StdinTerminal()) {</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">                fputc('\n', <span class='macro'>stdout<span class='macro_popup'>stdout</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">            gArgs.ForceSetArg(<span class='string_literal'>"-rpcpassword"</span>, rpcPass);</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line">        std::vector&lt;std::string&gt; args = std::vector&lt;std::string&gt;(&amp;argv[1], &amp;argv[argc]);</td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">        <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-stdinwalletpassphrase"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">            <span class='macro'>NO_STDIN_ECHO()<span class='macro_popup'>NoechoInst _no_echo</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">            std::string walletPass;</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">            <span class='keyword'>if</span> (args.size() &lt; 1 || args[0].substr(0, 16) != <span class='string_literal'>"walletpassphrase"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">                <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-stdinwalletpassphrase is only applicable for walletpassphrase(change)"</span>);</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line">            <span class='keyword'>if</span> (!StdinReady()) {</td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">                fputs(<span class='string_literal'>"Wallet passphrase&gt; "</span>, <span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">                fflush(<span class='macro'>stderr<span class='macro_popup'>stderr</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line">            <span class='keyword'>if</span> (!std::getline(std::cin, walletPass)) {</td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line">                <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"-stdinwalletpassphrase specified but failed to read from standard input"</span>);</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">            <span class='keyword'>if</span> (StdinTerminal()) {</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">                fputc('\n', <span class='macro'>stdout<span class='macro_popup'>stdout</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">            args.insert(args.begin() + 1, walletPass);</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">        <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-stdin"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">            <span class='comment'>// Read one arg per line from stdin and append</span></td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line">            std::string line;</td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line">            <span class='keyword'>while</span> (std::getline(std::cin, line)) {</td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">                args.push_back(line);</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">            <span class='keyword'>if</span> (StdinTerminal()) {</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">                fputc('\n', <span class='macro'>stdout<span class='macro_popup'>stdout</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line">        std::unique_ptr&lt;BaseRequestHandler&gt; rh;</td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line">        std::string method;</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">        <span class='keyword'>if</span> (gArgs.IsArgSet(<span class='string_literal'>"-getinfo"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">            rh.reset(<span class='keyword'>new</span> GetinfoRequestHandler());</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-netinfo"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">            <span class='keyword'>if</span> (!args.empty() &amp;&amp; args.at(0) == <span class='string_literal'>"help"</span>) {</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line">                tfm::format(std::cout, <span class='string_literal'>"%s\n"</span>, NetinfoRequestHandler().m_help_doc);</td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">                <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">            rh.reset(<span class='keyword'>new</span> NetinfoRequestHandler());</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-generate"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">            <span class='keyword'>const</span> UniValue getnewaddress{GetNewAddress()};</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">            <span class='keyword'>const</span> UniValue&amp; error{getnewaddress.find_value(<span class='string_literal'>"error"</span>)};</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">            <span class='keyword'>if</span> (error.isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">                SetGenerateToAddressArgs(getnewaddress.find_value(<span class='string_literal'>"result"</span>).get_str(), args);</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line">                rh.reset(<span class='keyword'>new</span> GenerateToAddressRequestHandler());</td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">                ParseError(error, strPrint, nRet);</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-addrinfo"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line">            rh.reset(<span class='keyword'>new</span> AddrinfoRequestHandler());</td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">            rh.reset(<span class='keyword'>new</span> DefaultRequestHandler());</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">            <span class='keyword'>if</span> (args.size() &lt; 1) {</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">                <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"too few parameters (need at least command)"</span>);</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">            method = args[0];</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">            args.erase(args.begin()); <span class='comment'>// Remove trailing method name from arguments vector</span></td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">        <span class='keyword'>if</span> (nRet == 0) {</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">            <span class='comment'>// Perform RPC call</span></td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line">            std::optional&lt;std::string&gt; wallet_name{};</td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line">            <span class='keyword'>if</span> (gArgs.IsArgSet(<span class='string_literal'>"-rpcwallet"</span>)) wallet_name = gArgs.GetArg(<span class='string_literal'>"-rpcwallet"</span>, <span class='string_literal'>""</span>);</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">            <span class='keyword'>const</span> UniValue reply = ConnectAndCallRPC(rh.get(), method, args, wallet_name);</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">            <span class='comment'>// Parse reply</span></td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line">            UniValue result = reply.find_value(<span class='string_literal'>"result"</span>);</td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line">            <span class='keyword'>const</span> UniValue&amp; error = reply.find_value(<span class='string_literal'>"error"</span>);</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">            <span class='keyword'>if</span> (error.isNull()) {</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">                <span class='keyword'>if</span> (gArgs.GetBoolArg(<span class='string_literal'>"-getinfo"</span>, <span class='keyword'>false</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">                    <span class='keyword'>if</span> (!gArgs.IsArgSet(<span class='string_literal'>"-rpcwallet"</span>)) {</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">                        GetWalletBalances(result); <span class='comment'>// fetch multiwallet balances and append to result</span></td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">                    }</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line">                    ParseGetInfoResult(result);</td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">                }</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">                ParseResult(result, strPrint);</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line">            } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">                ParseError(error, strPrint, nRet);</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line">    } <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">        strPrint = std::string(<span class='string_literal'>"error: "</span>) + e.what();</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">        nRet = <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line">    } <span class='keyword'>catch</span> (...) {</td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">        PrintExceptionContinue(<span class='keyword'>nullptr</span>, <span class='string_literal'>"CommandLineRPC()"</span>);</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">        <span class='keyword'>throw</span>;</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">    <span class='keyword'>if</span> (strPrint != <span class='string_literal'>""</span>) {</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">        tfm::format(nRet == 0 ? std::cout : std::cerr, <span class='string_literal'>"%s\n"</span>, strPrint);</td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">    <span class='keyword'>return</span> nRet;</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line"><span class='macro'>MAIN_FUNCTION<span class='macro_popup'>int main(int argc, char* argv[])</span></span></td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line"><span class='directive'>#ifdef WIN32</span></td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line">    common::WinCmdLineArgs winArgs;</td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">    std::tie(argc, argv) = winArgs.get();</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">    SetupEnvironment();</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">    <span class='keyword'>if</span> (!SetupNetworking()) {</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">        tfm::format(std::cerr, <span class='string_literal'>"Error: Initializing networking failed\n"</span>);</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">    event_set_log_callback(&amp;libevent_log_cb);</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">    <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">        <span class='keyword'>int</span> ret = AppInitRPC(argc, argv);</td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line">        <span class='keyword'>if</span> (ret != CONTINUE_EXECUTION)</td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">            <span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">    <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">        PrintExceptionContinue(&amp;e, <span class='string_literal'>"AppInitRPC()"</span>);</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">    } <span class='keyword'>catch</span> (...) {</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">        PrintExceptionContinue(<span class='keyword'>nullptr</span>, <span class='string_literal'>"AppInitRPC()"</span>);</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">    <span class='keyword'>int</span> ret = <span class='macro'>EXIT_FAILURE<span class='macro_popup'>1</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">    <span class='keyword'>try</span> {</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">        ret = CommandLineRPC(argc, argv);</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">    <span class='keyword'>catch</span> (<span class='keyword'>const</span> std::exception&amp; e) {</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">        PrintExceptionContinue(&amp;e, <span class='string_literal'>"CommandLineRPC()"</span>);</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line">    } <span class='keyword'>catch</span> (...) {</td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">        PrintExceptionContinue(<span class='keyword'>nullptr</span>, <span class='string_literal'>"CommandLineRPC()"</span>);</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line">    <span class='keyword'>return</span> ret;</td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">}</td></tr>
</table><hr class=divider>
<div id=File180655>
<div class=FileNav><a href="#File1">&#x2190;</a></div><h4 class=FileName>./univalue/include/univalue.h</h4>
</div>

<style type="text/css">
  svg {
      position:absolute;
      top:0;
      left:0;
      height:100%;
      width:100%;
      pointer-events: none;
      overflow: visible
  }
  .arrow {
      stroke-opacity: 0.2;
      stroke-width: 1;
      marker-end: url(#arrowhead);
  }

  .arrow.selected {
      stroke-opacity: 0.6;
      stroke-width: 2;
      marker-end: url(#arrowheadSelected);
  }

  .arrowhead {
      orient: auto;
      stroke: none;
      opacity: 0.6;
      fill: blue;
  }
</style>
<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowheadSelected" class="arrowhead" opacity="0.6"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowhead" class="arrowhead" opacity="0.2"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  <g id="arrows" fill="none" stroke="blue" visibility="hidden">
    <path class="arrow" id="arrow0"/>
    <path class="arrow" id="arrow1"/>
    <path class="arrow" id="arrow2"/>
    <path class="arrow" id="arrow3"/>
    <path class="arrow" id="arrow4"/>
    <path class="arrow" id="arrow5"/>
    <path class="arrow" id="arrow6"/>
    <path class="arrow" id="arrow7"/>
    <path class="arrow" id="arrow8"/>
    <path class="arrow" id="arrow9"/>
    <path class="arrow" id="arrow10"/>
    <path class="arrow" id="arrow11"/>
    <path class="arrow" id="arrow12"/>
    <path class="arrow" id="arrow13"/>
    <path class="arrow" id="arrow14"/>
    <path class="arrow" id="arrow15"/>
    <path class="arrow" id="arrow16"/>
    <path class="arrow" id="arrow17"/>
    <path class="arrow" id="arrow18"/>

  </g>
</svg>
<script type='text/javascript'>
const arrowIndices = [ 19,18,13,9,7,1,0 ]
</script>
<table class="code" data-fileid="180655">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>// Copyright 2014 BitPay Inc.</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line"><span class='comment'>// Copyright 2015 Bitcoin Core Developers</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line"><span class='comment'>// Distributed under the MIT software license, see the accompanying</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line"><span class='comment'>// file COPYING or https://opensource.org/licenses/mit-license.php.</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#ifndef BITCOIN_UNIVALUE_INCLUDE_UNIVALUE_H</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#define BITCOIN_UNIVALUE_INCLUDE_UNIVALUE_H</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include &lt;charconv&gt;</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include &lt;cstddef&gt;</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include &lt;cstdint&gt;</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include &lt;map&gt;</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include &lt;stdexcept&gt;</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include &lt;string&gt;</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include &lt;string_view&gt;</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include &lt;system_error&gt;</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include &lt;type_traits&gt;</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include &lt;utility&gt;</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include &lt;vector&gt;</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line"><span class='keyword'>class</span> UniValue {</td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">    <span class='keyword'>enum</span> VType { VNULL, VOBJ, VARR, VSTR, VNUM, VBOOL, };</td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line">    <span class='keyword'>class</span> type_error : <span class='keyword'>public</span> std::runtime_error</td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">        <span class='keyword'>using</span> std::runtime_error::runtime_error;</td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">    };</td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">    UniValue() { typ = VNULL; }</td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">    UniValue(UniValue::VType type, std::string str <span id="start3"><span id="end4">=</span></span> {}) : typ{type}, val{std::move(str)} {}</td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">    <span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Ref, <span class='keyword'>typename</span> T = std::remove_cv_t&lt;std::remove_reference_t&lt;Ref&gt;&gt;,</td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">              std::enable_if_t&lt;std::is_floating_point_v&lt;T&gt; ||                      <span class='comment'>// setFloat</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">                                   std::is_same_v&lt;<span class='keyword'>bool</span>, T&gt; ||                      <span class='comment'>// setBool</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">                                   std::is_signed_v&lt;T&gt; || std::is_unsigned_v&lt;T&gt; || <span class='comment'>// setInt</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">                                   std::is_constructible_v&lt;std::string, T&gt;,        <span class='comment'>// setStr</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">                               <span class='keyword'>bool</span>&gt; = <span class='keyword'>true</span>&gt;</td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">    UniValue(Ref&amp;&amp; val)</td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">        <span class='keyword'>if</span> <span class='keyword'>constexpr</span> (std::is_floating_point_v&lt;T&gt;) {</td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">            setFloat(val);</td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> (std::is_same_v&lt;<span class='keyword'>bool</span>, T&gt;) {</td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">            setBool(val);</td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> (std::is_signed_v&lt;T&gt;) {</td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">            setInt(int64_t{val});</td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">        } <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> (std::is_unsigned_v&lt;T&gt;) {</td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">            setInt(uint64_t{val});</td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">        } <span class='keyword'>else</span> {</td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">            setStr(std::string{std::forward&lt;Ref&gt;(val)});</td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line">    <span class='keyword'>void</span> clear();</td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line">    <span class='keyword'>void</span> setNull();</td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">    <span class='keyword'>void</span> setBool(<span class='keyword'>bool</span> val);</td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">    <span class='keyword'>void</span> setNumStr(std::string str);</td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">    <span class='keyword'>void</span> setInt(uint64_t val);</td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line">    <span class='keyword'>void</span> setInt(int64_t val);</td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">    <span class='keyword'>void</span> setInt(<span class='keyword'>int</span> val_) { <span class='keyword'>return</span> setInt(int64_t{val_}); }</td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">    <span class='keyword'>void</span> setFloat(<span class='keyword'>double</span> val);</td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">    <span class='keyword'>void</span> setStr(std::string str);</td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line">    <span class='keyword'>void</span> setArray();</td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">    <span class='keyword'>void</span> setObject();</td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">    <span class='keyword'>enum</span> VType getType() <span class='keyword'>const</span> { <span class='keyword'>return</span> typ; }</td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line">    <span class='keyword'>const</span> std::string&amp; getValStr() <span class='keyword'>const</span> { <span class='keyword'>return</span> val; }</td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">    <span class='keyword'>bool</span> empty() <span class='keyword'>const</span> { <span class='keyword'>return</span> (values.size() == 0); }</td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">    size_t size() <span class='keyword'>const</span> { <span class='keyword'>return</span> values.size(); }</td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">    <span class='keyword'>void</span> getObjMap(std::map&lt;std::string,UniValue&gt;&amp; kv) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">    <span class='keyword'>bool</span> checkObject(<span class='keyword'>const</span> std::map&lt;std::string,UniValue::VType&gt;&amp; memberTypes) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; <span class='keyword'>operator</span>[](<span class='keyword'>const</span> std::string&amp; key) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; <span class='keyword'>operator</span>[](size_t index) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line">    <span class='keyword'>bool</span> exists(<span class='keyword'>const</span> std::string&amp; key) <span class='keyword'>const</span> { size_t i; <span class='keyword'>return</span> findKey(key, i); }</td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">    <span class='keyword'>bool</span> isNull() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VNULL); }</td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">    <span class='keyword'>bool</span> isTrue() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VBOOL) &amp;&amp; (val == <span class='string_literal'>"1"</span>); }</td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">    <span class='keyword'>bool</span> isFalse() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VBOOL) &amp;&amp; (val != <span class='string_literal'>"1"</span>); }</td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line">    <span class='keyword'>bool</span> isBool() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VBOOL); }</td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">    <span class='keyword'>bool</span> isStr() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VSTR); }</td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">    <span class='keyword'>bool</span> isNum() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VNUM); }</td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line">    <span class='keyword'>bool</span> isArray() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VARR); }</td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">    <span class='keyword'>bool</span> isObject() <span class='keyword'>const</span> { <span class='keyword'>return</span> (typ == VOBJ); }</td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">    <span class='keyword'>void</span> push_back(UniValue val);</td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">    <span class='keyword'>void</span> push_backV(<span class='keyword'>const</span> std::vector&lt;UniValue&gt;&amp; vec);</td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">    <span class='keyword'>template</span> &lt;<span class='keyword'>class</span> It&gt;</td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">    <span class='keyword'>void</span> push_backV(It first, It last);</td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line">    <span class='keyword'>void</span> pushKVEnd(std::string key, UniValue val);</td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">    <span class='keyword'>void</span> pushKV(std::string key, UniValue val);</td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line">    <span class='keyword'>void</span> pushKVs(UniValue obj);</td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">    std::string write(<span class='keyword'>unsigned</span> <span class='keyword'>int</span> prettyIndent = 0,</td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line">                      <span class='keyword'>unsigned</span> <span class='keyword'>int</span> indentLevel = 0) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">    <span class='keyword'>bool</span> read(std::string_view raw);</td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line"><span class='keyword'>private</span>:</td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line">    UniValue::VType typ;</td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">    std::string val;                       <span class='comment'>// numbers are stored as C++ strings</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line">    std::vector&lt;std::string&gt; keys;</td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">    std::vector&lt;UniValue&gt; values;</td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">    <span class='keyword'>void</span> checkType(<span class='keyword'>const</span> VType&amp; expected) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line">    <span class='keyword'>bool</span> findKey(<span class='keyword'>const</span> std::string&amp; key, size_t&amp; retIdx) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">    <span class='keyword'>void</span> writeArray(<span class='keyword'>unsigned</span> <span class='keyword'>int</span> prettyIndent, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> indentLevel, std::string&amp; s) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">    <span class='keyword'>void</span> writeObject(<span class='keyword'>unsigned</span> <span class='keyword'>int</span> prettyIndent, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> indentLevel, std::string&amp; s) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line"><span class='keyword'>public</span>:</td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">    <span class='comment'>// Strict type-specific getters, these throw std::runtime_error if the</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">    <span class='comment'>// value is of unexpected type</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line">    <span class='keyword'>const</span> std::vector&lt;std::string&gt;&amp; getKeys() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">    <span class='keyword'>const</span> std::vector&lt;UniValue&gt;&amp; getValues() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">    <span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Int&gt;</td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">    Int getInt() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">    <span class='keyword'>bool</span> get_bool() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line">    <span class='keyword'>const</span> std::string&amp; get_str() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">    <span class='keyword'>double</span> get_real() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; get_obj() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; get_array() <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line">    <span class='keyword'>enum</span> VType type() <span class='keyword'>const</span> { <span class='keyword'>return</span> getType(); }</td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">    <span class='keyword'>const</span> UniValue&amp; find_value(std::string_view key) <span class='keyword'>const</span>;</td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>class</span> It&gt;</td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"><span class='keyword'>void</span> UniValue::push_backV(It first, It last)</td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">    checkType(VARR);</td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">    values.insert(values.end(), first, last);</td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"><span class='keyword'>template</span> &lt;<span class='keyword'>typename</span> Int&gt;</td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">Int UniValue::getInt() <span class='keyword'>const</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">    <span class='keyword'>static_assert</span>(std::is_integral&lt;Int&gt;::value);</td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">    checkType(VNUM);</td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line">    Int result;</td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>auto</span> [first_nonmatching, error_condition] = std::from_chars(val.data(), val.data() + val.size(), result);</td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">    <span class='keyword'>if</span> (first_nonmatching != val.data() + val.size() || error_condition != std::errc{}) {</td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">        <span class='keyword'>throw</span> std::runtime_error(<span class='string_literal'>"JSON integer out of range"</span>);</td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">    <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line"><span class='keyword'>enum</span> jtokentype {</td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">    JTOK_ERR        = -1,</td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">    JTOK_NONE       = 0,                           <span class='comment'>// eof</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">    JTOK_OBJ_OPEN,</td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line">    JTOK_OBJ_CLOSE,</td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">    JTOK_ARR_OPEN,</td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">    JTOK_ARR_CLOSE,</td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">    JTOK_COLON,</td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line">    JTOK_COMMA,</td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line">    JTOK_KW_NULL,</td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line">    JTOK_KW_TRUE,</td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line">    JTOK_KW_FALSE,</td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line">    JTOK_NUMBER,</td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line">    JTOK_STRING,</td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>enum</span> jtokentype getJsonToken(std::string&amp; tokenVal,</td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line">                                    <span class='keyword'>unsigned</span> <span class='keyword'>int</span>&amp; consumed, <span class='keyword'>const</span> <span class='keyword'>char</span> *raw, <span class='keyword'>const</span> <span class='keyword'>char</span> *end);</td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *uvTypeName(UniValue::VType t);</td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>bool</span> jsonTokenIsValue(<span class='keyword'>enum</span> jtokentype jtt)</td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line">    <span class='keyword'>switch</span> (jtt) {</td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line">    <span class='keyword'>case</span> JTOK_KW_NULL:</td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line">    <span class='keyword'>case</span> JTOK_KW_TRUE:</td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line">    <span class='keyword'>case</span> JTOK_KW_FALSE:</td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line">    <span class='keyword'>case</span> JTOK_NUMBER:</td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line">    <span class='keyword'>case</span> JTOK_STRING:</td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line">    <span class='comment'>// not reached</span></td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>bool</span> json_isspace(<span class='keyword'>int</span> ch)</td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line">    <span class='keyword'>switch</span> (ch) {</td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line">    <span class='keyword'>case</span> 0x20:</td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line">    <span class='keyword'>case</span> 0x09:</td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line">    <span class='keyword'>case</span> 0x0a:</td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line">    <span class='keyword'>case</span> 0x0d:</td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>true</span>;</td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line">        <span class='keyword'>return</span> <span class='keyword'>false</span>;</td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">    <span class='comment'>// not reached</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"><span class='keyword'>extern</span> <span class='keyword'>const</span> UniValue NullUniValue;</td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"><span class='directive'>#endif // BITCOIN_UNIVALUE_INCLUDE_UNIVALUE_H</span></td></tr>
</table></body></html>
